
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up the sprinkler controller component in ESPHome to control sprinkler valves.">
<meta itemprop="name" content="Sprinkler Controller">
<meta itemprop="description" content="Instructions for setting up the sprinkler controller component in ESPHome to control sprinkler valves.">
<meta itemprop="image" content="https://esphome.io/_images/sprinkler-variant.png">
<meta name="twitter:title" content="Sprinkler Controller">
<meta name="twitter:image:src" content="https://esphome.io/_images/sprinkler-variant.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up the sprinkler controller component in ESPHome to control sprinkler valves.">
<meta property="og:title" content="Sprinkler Controller">
<meta property="og:image" content="https://esphome.io/_images/sprinkler-variant.png">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up the sprinkler controller component in ESPHome to control sprinkler valves.">

    <title>Sprinkler Controller &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../_static/pygments_dark.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/sprinkler.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Status LED" href="status_led.html" />
    <link rel="prev" title="SPI Bus" href="spi.html" />
  <link rel="stylesheet" href="../_static/custom.css?hash=ab494674" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo-text.svg" alt="Logo"/>
            </a></p><link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>

<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>

  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Sprinkler Controller</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
<li><a class="reference internal" href="#an-important-note-about-gpio-switches-and-control">An Important Note about GPIO Switches and Control</a></li>
<li><a class="reference internal" href="#controller-actions">Controller Actions</a><ul>
<li><a class="reference internal" href="#sprinkler-start-full-cycle-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.start_full_cycle</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-start-from-queue-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.start_from_queue</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-start-single-valve-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.start_single_valve</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-shutdown-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.shutdown</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-next-valve-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.next_valve</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-previous-valve-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.previous_valve</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-pause-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.pause</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-resume-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.resume</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-resume-or-start-full-cycle-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.resume_or_start_full_cycle</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-queue-valve-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.queue_valve</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-clear-queued-valves-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.clear_queued_valves</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-set-multiplier-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.set_multiplier</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-set-repeat-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.set_repeat</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-set-divider-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.set_divider</span></code> action</a></li>
<li><a class="reference internal" href="#sprinkler-set-valve-run-duration-action"><code class="docutils literal notranslate"><span class="pre">sprinkler.set_valve_run_duration</span></code> action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pump-and-distribution-valve-coordination">Pump and Distribution Valve Coordination</a><ul>
<li><a class="reference internal" href="#delayed-starting-and-or-stopping-of-pumps-or-valves">Delayed Starting and/or Stopping of Pumps or Valves</a></li>
<li><a class="reference internal" href="#banging-pipes-or-valves-that-don-t-consistently-close">Banging Pipes or Valves That Don’t Consistently Close</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-examples">Controller Examples</a><ul>
<li><a class="reference internal" href="#single-controller-single-valve-no-pump">Single Controller, Single Valve, No Pump</a></li>
<li><a class="reference internal" href="#single-controller-three-valves-no-pump">Single Controller, Three Valves, No Pump</a></li>
<li><a class="reference internal" href="#single-controller-three-valves-single-pump">Single Controller, Three Valves, Single Pump</a></li>
<li><a class="reference internal" href="#single-controller-three-latching-valves-single-latching-pump">Single Controller, Three Latching Valves, Single Latching Pump</a></li>
<li><a class="reference internal" href="#dual-controller-five-valves-two-pumps">Dual Controller, Five Valves, Two Pumps</a></li>
<li><a class="reference internal" href="#using-the-sprinkler-controller-s-numbers">Using the Sprinkler Controller’s Numbers</a></li>
<li><a class="reference internal" href="#extending-the-sprinkler-controller-s-switches">Extending the Sprinkler Controller’s Switches</a></li>
<li><a class="reference internal" href="#the-sprinkler-controller-queue">The Sprinkler Controller Queue</a></li>
<li><a class="reference internal" href="#expose-sprinkler-controller-actions-via-user-api">Expose Sprinkler Controller Actions via user-API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#understanding-the-sprinkler-controller-s-state">Understanding the Sprinkler Controller’s State</a><ul>
<li><a class="reference internal" href="#how-do-i">How Do I…</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  
  <ul class="breadcrumbs">
      <li><a href="index.html">Components</a> ➔</li>
      <li>Sprinkler Controller</li>
  </ul>
  


          <div class="body" role="main">
            
  <section id="sprinkler-controller">
<h1>Sprinkler Controller<a class="headerlink" href="#sprinkler-controller" title="Permalink to this heading">¶</a></h1>
<figure class="align-center">
<img alt="../_images/sprinkler.png" src="../_images/sprinkler.png" />
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">sprinkler</span></code> controller component aims to behave like a sprinkler/irrigation valve controller,
much like those made by companies such as Rain Bird or Hunter. It does so by automating control of a
number of <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a> components, each of which would typically be used to control
an individual electric valve via a relay or other switching device. It provides a number of features
you’d expect of a sprinkler controller, including:</p>
<ul class="simple">
<li><p>Virtually any number of zones (sections of the sprinkler system) per controller instance, limited only by
available memory and/or GPIO (including I/O expanders!) pin availability on the ESP</p></li>
<li><p>The ability to run:</p>
<ul>
<li><p>One or more full cycles (iterations through all zones) of the system</p></li>
<li><p>Only a single zone</p></li>
</ul>
</li>
<li><p>Automatic cycle repeating</p></li>
<li><p>A multiplier value to proportionally increase or decrease the run duration for all zones</p></li>
<li><p>Support for pumps/main valves located upstream of distribution valves</p></li>
<li><p>Pausing and resuming a zone/cycle</p></li>
<li><p>Iterating through zones in forward or reverse order</p></li>
<li><p>Support for both latching (“pulsed”) and non-latching valves (which can be arbitrarily mixed!)</p></li>
</ul>
<p>It reaches even further, however, offering several more advanced features, as well:</p>
<ul class="simple">
<li><p>Multiple sprinkler controller instances can operate simultaneously on a single (ESP) device</p></li>
<li><p>Multiple pumps, each of which may be shared across controller instances</p></li>
<li><p>Enable/disable switches for each individual zone, allowing zones to be omitted from full cycles of the system</p></li>
<li><p>A valve/zone queuing mechanism aimed at providing advanced support for automation</p></li>
<li><p>Several valve management strategies to accommodate varying types of hardware/installations:</p>
<ul>
<li><p>Adjustable “valve open delay” to help ensure valves are fully closed before the next one is opened</p></li>
<li><p>Adjustable “valve overlap” to help minimize banging of pipes due to water hammer</p></li>
<li><p>Adjustable delay intervals to coordinate pump starting and stopping relative to distribution valve opening and closing</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the term “pump” is used throughout this document, the device controlled need not be a
physical pump. Instead, it may simply be another electric valve located upstream of distribution
valves (often known in the industry as a “main” or “master” valve). The pump or upstream valve
simply controls the water supply to other downstream valves.</p>
</div>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/sprinkler-ui.jpg"><img alt="../_images/sprinkler-ui.jpg" src="../_images/sprinkler-ui.jpg" style="width: 60.0%;" /></a>
<figcaption>
<p><span class="caption-text">Example Sprinkler Controller UI – Note that this example leverages <a class="reference internal" href="number/index.html"><span class="doc">number</span></a>
components for setting run durations, repeat and multiplier values.
<a class="reference internal" href="#sprinkler-controller-sprinkler-controller-numbers"><span class="std std-ref">More details below.</span></a></span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example minimal configuration entry</span>
<span class="c1"># (...but please see more detailed examples below!)</span>
<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sprinklers&quot;</span>
<span class="w">    </span><span class="nt">auto_advance_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sprinklers</span><span class="nv"> </span><span class="s">Auto</span><span class="nv"> </span><span class="s">Advance&quot;</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1800s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
</pre></div>
</div>
<p>Please see the <a class="reference internal" href="#sprinkler-controller-examples"><span class="std std-ref">Controller Examples</span></a> section below for extensive, detailed configuration
examples that are ready for you to copy and paste!</p>
<section id="configuration-variables">
<h2>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>main_switch</strong> (<em>Optional</em>, <em>string</em>): Required with more than one valve. The name for the sprinkler
controller’s main switch as it will appear in the front end. This switch, when turned on, calls the
<code class="docutils literal notranslate"><span class="pre">sprinkler.resume_or_start_full_cycle</span></code> action; when turned off, it calls the <code class="docutils literal notranslate"><span class="pre">sprinkler.shutdown</span></code>
action (see below). It will appear to be “on” when any valve on the controller is active. This switch
will not appear in the front end if the controller is configured with only one valve.</p></li>
<li><p><strong>auto_advance_switch</strong> (<em>Optional</em>, <em>string</em>): Required with more than one valve. The name for the
sprinkler controller’s “auto-advance” switch as it will appear in the front end. When this switch is
turned on while a valve is active, when the valve’s <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> is reached, the sprinkler
controller will automatically advance to the next enabled valve as a part of a “full cycle” of the
system. When turned off, the sprinkler controller will shut down after the active valve’s
<code class="docutils literal notranslate"><span class="pre">run_duration</span></code> is reached (unless there are valves in the queue – see
<a class="reference internal" href="#sprinkler-controller-sprinkler-controller-queue"><span class="std std-ref">The Sprinkler Controller Queue</span></a> section below for more detail). This switch will
not appear in the front end if the controller is configured with only one valve.</p></li>
<li><p><strong>manual_selection_delay</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The amount of time the controller should
wait to activate a valve after the <code class="docutils literal notranslate"><span class="pre">next_valve</span></code> and <code class="docutils literal notranslate"><span class="pre">previous_valve</span></code> actions are called. Useful
if the control interface consists of only forward/reverse buttons as the button(s) may be pressed
multiple times to make the selection.</p></li>
<li><p><strong>queue_enable_switch</strong> (<em>Optional</em>, <em>string</em>): The name for the sprinkler controller’s queue enable
switch as it will appear in the front end. When this switch is turned on or not provided, the controller
will select the next valve/zone to run based on the contents of the queue; the queue takes precedence over
valves that would otherwise run as a part of a full cycle of the system (when auto-advance is on/enabled).
See <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-queue"><span class="std std-ref">The Sprinkler Controller Queue</span></a> section below for more detail.</p></li>
<li><p><strong>reverse_switch</strong> (<em>Optional</em>, <em>string</em>): The name for the sprinkler controller’s reverse switch
as it will appear in the front end. When this switch is turned on, the controller will iterate through
the valves in reverse order (last-to-first as they appear in the controller’s configuration). When
this switch is turned off or not provided, the controller will iterate through the valves first-to-last.
This switch will not appear in the front end if the controller is configured with only one valve.</p></li>
<li><p><strong>standby_switch</strong> (<em>Optional</em>, <em>string</em>): The name for the sprinkler controller’s standby switch
as it will appear in the front end. When this switch is turned on, the controller <em>will not start any valves.</em>
<strong>This can result in confusing/unexpected behavior if there is no visual indication of this condition!</strong></p></li>
<li><p><strong>valve_open_delay</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The <em>minimum</em> delay in seconds that should be
inserted between (distribution) valve switching – in other words, the amount of time that must elapse
between one valve switching off and the next one switching on. Useful for systems with valves which depend
on sufficient water pressure to close. May not be used with <code class="docutils literal notranslate"><span class="pre">valve_overlap</span></code>.</p></li>
<li><p><strong>valve_overlap</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The amount of time in seconds that the current valve
and the next valve should run simultaneously as the next valve/zone starts up. This may help prevent pipes
from banging as valves close. May not be used with <code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code>.</p></li>
<li><p><strong>pump_switch_off_during_valve_open_delay</strong> (<em>Optional</em>, boolean): If set to <code class="docutils literal notranslate"><span class="pre">true</span></code>, the pump will be
switched off during the <code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code> interval; otherwise, it remains on. This may only be
specified when <code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code> is configured (see above). Defaults to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><strong>pump_start_pump_delay</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The delay in seconds from when a distribution
valve is opened to when the associated pump is activated. Useful to ensure pressure does not build
up from running the pump when no distribution valves are open. May not be used with <code class="docutils literal notranslate"><span class="pre">pump_start_valve_delay</span></code>.</p></li>
<li><p><strong>pump_start_valve_delay</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The delay in seconds from when a pump
is started to when the associated distribution valve is opened. Useful for systems where distribution
valves require sufficient pressure to fully/quickly close. May not be used with <code class="docutils literal notranslate"><span class="pre">pump_start_pump_delay</span></code>.</p></li>
<li><p><strong>pump_stop_pump_delay</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The delay in seconds from when a distribution
valve is closed to when the respective pump is deactivated. Useful for systems where distribution valves
require sufficient pressure to fully/quickly close. May not be used with <code class="docutils literal notranslate"><span class="pre">pump_stop_valve_delay</span></code>.</p></li>
<li><p><strong>pump_stop_valve_delay</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The delay in seconds from when a pump is
deactivated to when the respective distribution valve is closed. Useful to ensure pressure does not build
up from running the pump when no distribution valves are open or to allow the main line out to distribution
valves to drain. May not be used with <code class="docutils literal notranslate"><span class="pre">pump_stop_pump_delay</span></code>.</p></li>
<li><p><strong>pump_pulse_duration</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The <em>minimum</em> length of the pulse generated to
operate a pump in milliseconds. <em>Required</em> when one or more latching pumps is configured. Note that the <em>exact</em>
length of the pulse is determined by the frequency of the main application loop (as are other <code class="docutils literal notranslate"><span class="pre">delay</span></code> timers
used in ESPHome). Typically this is expected to provide a resolution of approximately 16 milliseconds, however
this may vary somewhat depending on your exact configuration. Regardless, it should provide
more-than-sufficient precision to operate any such valve.</p></li>
<li><p><strong>valve_pulse_duration</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The <em>minimum</em> length of the pulse generated to
operate a valve in milliseconds. <em>Required</em> when one or more latching valves is configured. Note that the <em>exact</em>
length of the pulse is determined by the frequency of the main application loop (as are other <code class="docutils literal notranslate"><span class="pre">delay</span></code> timers
used in ESPHome). Typically this is expected to provide a resolution of approximately 16 milliseconds, however
this may vary somewhat depending on your exact configuration. Regardless, it should provide more-than-sufficient
precision to operate any such valve.</p></li>
<li><p><strong>multiplier_number</strong> (<em>Optional</em>, <em>string</em>): The name of the <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> component that
should be presented to the front end (Home Assistant) to enable control of the sprinkler controller’s <code class="docutils literal notranslate"><span class="pre">multiplier</span></code>
value. See <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-numbers"><span class="std std-ref">Using the Sprinkler Controller’s Numbers</span></a> below for more detail.</p></li>
<li><p><strong>repeat_number</strong> (<em>Optional</em>, <em>string</em>): The name of the <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> component that
should be presented to the front end (Home Assistant) to enable control of the sprinkler controller’s <code class="docutils literal notranslate"><span class="pre">repeat</span></code>
value. May not be used with <code class="docutils literal notranslate"><span class="pre">repeat</span></code>. See <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-numbers"><span class="std std-ref">Using the Sprinkler Controller’s Numbers</span></a> below for more
detail.</p></li>
<li><p><strong>repeat</strong> (<em>Optional</em>, int): The number of times a full cycle should be repeated. Defaults to 0. May not be used
with <code class="docutils literal notranslate"><span class="pre">repeat_number</span></code>.</p></li>
<li><p><strong>next_prev_ignore_disabled</strong> (<em>Optional</em>, boolean): Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to cause
<a class="reference internal" href="#sprinkler-controller-action-next-valve"><span class="std std-ref">sprinkler.next_valve action</span></a> and <a class="reference internal" href="#sprinkler-controller-action-previous-valve"><span class="std std-ref">sprinkler.previous_valve action</span></a> to skip
over valves that are not enabled. Defaults to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID used for code generation. While optional,
this is necessary to identify the controller instance (particularly in cases where more than one is
defined) when calling controller actions (see below) such as <code class="docutils literal notranslate"><span class="pre">start_full_cycle</span></code> or <code class="docutils literal notranslate"><span class="pre">shutdown</span></code>.</p></li>
<li><p><strong>valves</strong> (<strong>Required</strong>, <em>list</em>): A list of valves the controller should use. Each valve consists of:</p>
<ul>
<li><p><strong>enable_switch</strong> (<em>Optional</em>, <em>string</em>): The name for the switch component to be used to enable
this valve to be run as a part of a full cycle of the system. When this switch is turned off, the valve
will be excluded from a full cycle of the system. When this switch is turned on or not provided, the
controller will include the valve in a full cycle of the system.</p></li>
<li><p><strong>valve_switch</strong> (<strong>Required</strong>, <em>string</em>): The name for the switch component to be used to control
the valve for this part of the sprinkler system (often referred to as a “zone”). When this switch is
turned on, the controller’s “auto-advance” feature is disabled and it will activate the associated
valve for its <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> multiplied by the controller’s multiplier value. When this switch is
turned off, the <code class="docutils literal notranslate"><span class="pre">sprinkler.shutdown</span></code> action is called (see below).</p></li>
<li><p><strong>pump_switch_id</strong> (<em>Optional</em>, <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">Switch</span></a>): This is the <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>
component to be used to control the valve’s pump or upstream electric valve. Typically this would be a
<a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> wired to control a relay or other switching device which in turn would
activate the respective pump/valve. <em>It is not recommended to expose this switch to the front end; please
see</em> <a class="reference internal" href="#sprinkler-controller-an-important-note-about-gpio-switches-and-control"><span class="std std-ref">An Important Note about GPIO Switches and Control</span></a> <em>below for more detail.</em>
May not be specified with <em>pump_off_switch_id</em> or <em>pump_on_switch_id</em>.</p></li>
<li><p><strong>pump_off_switch_id</strong> (<em>Optional</em>, <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">Switch</span></a>): This is the <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>
component to be used to <em>turn off</em> the valve’s pump or upstream electric <em>latching</em> valve. Typically this
would be a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> wired to control a relay or other switching device which in turn
would <em>switch off</em> the respective pump/valve. <em>It is not recommended to expose this switch to the front end; please
see</em> <a class="reference internal" href="#sprinkler-controller-an-important-note-about-gpio-switches-and-control"><span class="std std-ref">An Important Note about GPIO Switches and Control</span></a> <em>below for more detail.</em>
May not be specified with <em>pump_switch_id</em>.</p></li>
<li><p><strong>pump_on_switch_id</strong> (<em>Optional</em>, <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">Switch</span></a>): This is the <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>
component to be used to <em>turn on</em> the valve’s pump or upstream electric <em>latching</em> valve. Typically this
would be a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> wired to control a relay or other switching device which in turn
would <em>switch on</em> the respective pump/valve. <em>It is not recommended to expose this switch to the front end; please
see</em> <a class="reference internal" href="#sprinkler-controller-an-important-note-about-gpio-switches-and-control"><span class="std std-ref">An Important Note about GPIO Switches and Control</span></a> <em>below for more detail.</em>
May not be specified with <em>pump_switch_id</em>.</p></li>
<li><p><strong>run_duration_number</strong> (<em>Optional</em>, <em>string</em>): The name of the <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> component
that should be presented to the front end (Home Assistant) to enable control of the valve’s <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> value.
May not be used with <code class="docutils literal notranslate"><span class="pre">run_duration</span></code>. See <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-numbers"><span class="std std-ref">Using the Sprinkler Controller’s Numbers</span></a> below for more
detail. <strong>Pro tip:</strong> Want times in minutes? Add <code class="docutils literal notranslate"><span class="pre">unit_of_measurement:</span> <span class="pre">min</span></code> to the number configuration. See
<a class="reference internal" href="#sprinkler-controller-sprinkler-controller-numbers"><span class="std std-ref">Using the Sprinkler Controller’s Numbers</span></a> for more detail.</p></li>
<li><p><strong>run_duration</strong> (<em>Optional</em>, <a class="reference internal" href="../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): Required when <code class="docutils literal notranslate"><span class="pre">run_duration_number</span></code> is not provided. The
duration in seconds this valve should remain on/open after it is activated. When a given valve is activated, the
controller’s multiplier value is multiplied by this value to determine the actual run duration for the valve, thus
allowing the run duration for all valves/zones to be proportionally increased or decreased as desired. May not be
used with <code class="docutils literal notranslate"><span class="pre">run_duration_number</span></code>.</p></li>
<li><p><strong>valve_switch_id</strong> (<strong>Required</strong>, <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">Switch</span></a>): This is the <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>
component to be used to control the valve that operates the given section or zone of the sprinkler
system. Typically this would be a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> wired to control a relay
or other switching device which in turn would activate the respective valve. <em>It is not recommended
to expose this switch to the front end; please see</em> <a class="reference internal" href="#sprinkler-controller-an-important-note-about-gpio-switches-and-control"><span class="std std-ref">An Important Note about GPIO Switches and Control</span></a>
<em>below for more detail.</em> May not be specified with <em>valve_off_switch_id</em> or <em>valve_on_switch_id</em>.</p></li>
<li><p><strong>valve_off_switch_id</strong> (<strong>Required</strong>, <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">Switch</span></a>): This is the <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>
component to be used to <em>turn off</em> the <em>latching</em> valve that operates the given section or zone of the
sprinkler system. Typically this would be a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> wired to control a relay
or other switching device which in turn would <em>switch off</em> the respective valve. <em>It is not recommended
to expose this switch to the front end; please see</em> <a class="reference internal" href="#sprinkler-controller-an-important-note-about-gpio-switches-and-control"><span class="std std-ref">An Important Note about GPIO Switches and Control</span></a>
<em>below for more detail.</em> May not be specified with <em>valve_switch_id</em>.</p></li>
<li><p><strong>valve_on_switch_id</strong> (<strong>Required</strong>, <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">Switch</span></a>): This is the <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>
component to be used to <em>turn on</em> the <em>latching</em> valve that operates the given section or zone of the
sprinkler system. Typically this would be a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> wired to control a relay
or other switching device which in turn would <em>switch on</em> the respective valve. <em>It is not recommended
to expose this switch to the front end; please see</em> <a class="reference internal" href="#sprinkler-controller-an-important-note-about-gpio-switches-and-control"><span class="std std-ref">An Important Note about GPIO Switches and Control</span></a>
<em>below for more detail.</em> May not be specified with <em>valve_switch_id</em>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="an-important-note-about-gpio-switches-and-control">
<span id="sprinkler-controller-an-important-note-about-gpio-switches-and-control"></span><h2>An Important Note about GPIO Switches and Control<a class="headerlink" href="#an-important-note-about-gpio-switches-and-control" title="Permalink to this heading">¶</a></h2>
<p>The savvy and/or seasoned ESPHome user will quickly realize that <code class="docutils literal notranslate"><span class="pre">pump_switch_id</span></code>, <code class="docutils literal notranslate"><span class="pre">pump_off_switch_id</span></code>,
<code class="docutils literal notranslate"><span class="pre">pump_on_switch_id</span></code>, <code class="docutils literal notranslate"><span class="pre">valve_switch_id</span></code>, <code class="docutils literal notranslate"><span class="pre">valve_off_switch_id</span></code> and <code class="docutils literal notranslate"><span class="pre">valve_on_switch_id</span></code> (as described above)
are really just pointers to other (GPIO) switches elsewhere in the ESPHome yaml configuration.</p>
<p>It might seem reasonable to assume that these <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switches</span></a> may be used to switch the various
sprinkler zones on and off, however, this is <strong>not</strong> the case. It’s important to note that the sprinkler controller
provides a switch for each configured zone – ultimately, this switch is to be used to switch any given zone on or
off, <strong>not</strong> the <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> the zone is configured with.</p>
<p>Keep in mind that a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> directly controls the state of the GPIO pin it is associated
with. While it’s technically feasible to “override” this behavior, it might not always be desirable. For example,
if you <em>wanted</em> to control the state of the switch/pin manually during testing of your system/configuration, this
would make doing so impossible (or at least more difficult than necessary), presenting other complications. Ultimately,
flexibility is key, as we’ve learned from any number of conversations on the ESPHome Discord server.</p>
<p>As mentioned in the introduction, the sprinkler controller automates control of the <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switches</span></a>
you provide it with – it does not “override” control of these switches or alter how they behave beyond simply
switching them on or off as required based on the configured scheduling.</p>
<p>So why not just use the <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> to control the various sprinkler zones directly? As it relates
to the sprinkler controller itself, the primary reason relates to <em>state</em> – that is, we need to be able to ensure
that the <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> state(s) are kept consistent with the configuration of the sprinkler
controller. While it’s less important for systems that simply consist of one valve per zone, it becomes very important
for systems with some additional complexity. Consider the example of a system with a pump and multiple distribution
valves attached to said pump; the controller in this case is configured to switch the pump off three seconds <em>before</em>
switching off any given distribution valve. If you suddenly manually switch off a <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a>
connected to one of these distribution valves, what happens to the pump? What should the sprinkler controller do? Should
it switch the distribution valve back on?…or maybe just switch the pump off, too? In either case, based on its
configuration, the pump was supposed be shut down before the valve, but you just went and turned off the valve. The pump
could be damaged. There are many other similar situations such as this that may occur, the simplest of which is little
more than ensuring that any given valve is switched off after <em>some</em> duration and does not remain on/open perpetually.</p>
<p>In summary, to ensure that your sprinkler controller consistently operates as expected:</p>
<ul class="simple">
<li><p>Only use the switches provided by the sprinkler controller component to switch any given sprinkler zone on or off.</p></li>
<li><p>Do not use the <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switches</span></a> you have in your configuration to control sprinkler zones/valves
outside of initial testing of your device configuration.</p></li>
<li><p>To help prevent accidents, it’s probably best if the <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switches</span></a> for each sprinkler zone are
<strong>not</strong> exposed to the front end. This can be accomplished in two ways:</p>
<ul>
<li><p>Do not provide a <code class="docutils literal notranslate"><span class="pre">name:</span></code> parameter to your <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switches</span></a>, or</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">internal:</span> <span class="pre">true</span></code> to each of your <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> configurations</p></li>
</ul>
</li>
</ul>
<p>These simple configuration tweaks will help prevent any number of errors (human, automation, or otherwise) and may help
to avert disaster!</p>
</section>
<section id="controller-actions">
<span id="sprinkler-controller-actions"></span><h2>Controller Actions<a class="headerlink" href="#controller-actions" title="Permalink to this heading">¶</a></h2>
<section id="sprinkler-start-full-cycle-action">
<span id="sprinkler-controller-action-start-full-cycle"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.start_full_cycle</span></code> action<a class="headerlink" href="#sprinkler-start-full-cycle-action" title="Permalink to this heading">¶</a></h3>
<p>Starts a full cycle of the system. This enables the controller’s “auto-advance” feature and disables
the queue. The controller will iterate through all enabled valves/zones. They will each run for their
configured <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> multiplied by the controller’s multiplier value. <em>Note that if NO valves
are enabled when this action is called, the controller will automatically enable all valves.</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.start_full_cycle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-start-from-queue-action">
<span id="sprinkler-controller-action-start-from-queue"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.start_from_queue</span></code> action<a class="headerlink" href="#sprinkler-start-from-queue-action" title="Permalink to this heading">¶</a></h3>
<p>Starts the controller running valves from its queue. If no valves are in the queue, this action does
nothing; otherwise, this disables the controller’s “auto-advance” feature so that only queued
valves/zones will run. Queued valves will remain on for either the amount of time specified in the
queue request or for their configured <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> multiplied by the controller’s multiplier value
(if the queue request run duration is not specified or is zero). <em>Note that queued valves ignore whether
the valve is enabled; that is, queued valves will always run once the controller is started, unless, of
course, the queue is (manually) cleared prior to the queue reaching them. Also note that, at present,
the queue has a hard-coded limit of 100 entries to limit memory use.</em>
See <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-queue"><span class="std std-ref">The Sprinkler Controller Queue</span></a> section below for more detail.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.start_from_queue</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-start-single-valve-action">
<span id="sprinkler-controller-action-start-single-valve"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.start_single_valve</span></code> action<a class="headerlink" href="#sprinkler-start-single-valve-action" title="Permalink to this heading">¶</a></h3>
<p>Starts a single valve. This disables the controller’s “auto-advance” and queue features so that only this valve/zone
will run. The valve will remain on for the specified duration or (if <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> is not specified or is zero) for
its configured <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> multiplied by the controller’s multiplier value. <em>Note that this action ignores whether
the valve is enabled; that is, when called, the specified valve will always run.</em> Valves are numbered in the order they
appear in the sprinkler controller’s configuration starting at zero (0).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.start_single_valve</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">        </span><span class="nt">valve_number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600s</span><span class="w">  </span><span class="c1"># optional</span>
</pre></div>
</div>
</section>
<section id="sprinkler-shutdown-action">
<span id="sprinkler-controller-action-shutdown"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.shutdown</span></code> action<a class="headerlink" href="#sprinkler-shutdown-action" title="Permalink to this heading">¶</a></h3>
<p>Initiates a shutdown of all valves/the system, respecting any configured pump or valve stop delays.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.shutdown</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-next-valve-action">
<span id="sprinkler-controller-action-next-valve"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.next_valve</span></code> action<a class="headerlink" href="#sprinkler-next-valve-action" title="Permalink to this heading">¶</a></h3>
<p>Advances to the next valve (numerically). If <code class="docutils literal notranslate"><span class="pre">manual_selection_delay</span></code> is configured, the controller
will wait before activating the selected valve. If no valve is active, the first valve (as they appear
in the controller’s configuration) will be started. Setting <code class="docutils literal notranslate"><span class="pre">next_prev_ignore_disabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>
will cause this action to skip valves that are not enabled via their valve enable switch (see above).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.next_valve</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-previous-valve-action">
<span id="sprinkler-controller-action-previous-valve"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.previous_valve</span></code> action<a class="headerlink" href="#sprinkler-previous-valve-action" title="Permalink to this heading">¶</a></h3>
<p>Advances to the previous valve (numerically). If <code class="docutils literal notranslate"><span class="pre">manual_selection_delay</span></code> is configured, the controller
will wait before activating the selected valve. If no valve is active, the last valve (as they appear in
the controller’s configuration) will be started. Setting <code class="docutils literal notranslate"><span class="pre">next_prev_ignore_disabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> will
cause this action to skip valves that are not enabled via their valve enable switch (see above).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.previous_valve</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-pause-action">
<span id="sprinkler-controller-action-pause"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.pause</span></code> action<a class="headerlink" href="#sprinkler-pause-action" title="Permalink to this heading">¶</a></h3>
<p>Immediately turns off all valves, saving the active valve and the amount of time remaining so that
the cycle may be resumed later on.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.pause</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-resume-action">
<span id="sprinkler-controller-action-resume"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.resume</span></code> action<a class="headerlink" href="#sprinkler-resume-action" title="Permalink to this heading">¶</a></h3>
<p>Resumes a cycle placed on hold with <code class="docutils literal notranslate"><span class="pre">sprinkler.pause</span></code>. If there is no paused cycle, this action
will do nothing.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.resume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-resume-or-start-full-cycle-action">
<span id="sprinkler-controller-action-resume-or-start-full-cycle"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.resume_or_start_full_cycle</span></code> action<a class="headerlink" href="#sprinkler-resume-or-start-full-cycle-action" title="Permalink to this heading">¶</a></h3>
<p>Resumes a cycle placed on hold with <code class="docutils literal notranslate"><span class="pre">sprinkler.pause</span></code>, but if no cycle was paused, starts a full
cycle (equivalent to <code class="docutils literal notranslate"><span class="pre">sprinkler.start_full_cycle</span></code>).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.resume_or_start_full_cycle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-queue-valve-action">
<span id="sprinkler-controller-action-queue-valve"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.queue_valve</span></code> action<a class="headerlink" href="#sprinkler-queue-valve-action" title="Permalink to this heading">¶</a></h3>
<p>Adds the specified valve into the controller’s queue. When the queue is enabled, valves in the queue
take precedence over valves scheduled as a part of a full cycle of the system (when auto-advance is
enabled). If <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> is not specified or is zero, the sprinkler controller will use the
valve’s configured run duration. Valves are numbered in the order they appear in the sprinkler
controller’s configuration starting at zero (0). <em>Note that, at present, the queue has a hard-coded
limit of 100 entries to limit memory use.</em> Please see <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-queue"><span class="std std-ref">The Sprinkler Controller Queue</span></a>
section below for more detail and examples.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.queue_valve</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">        </span><span class="nt">valve_number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
</pre></div>
</div>
</section>
<section id="sprinkler-clear-queued-valves-action">
<span id="sprinkler-controller-action-clear-queued-valves"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.clear_queued_valves</span></code> action<a class="headerlink" href="#sprinkler-clear-queued-valves-action" title="Permalink to this heading">¶</a></h3>
<p>Removes all queued valves from the controller’s queue. Please see <a class="reference internal" href="#sprinkler-controller-sprinkler-controller-queue"><span class="std std-ref">The Sprinkler Controller Queue</span></a>
section below for more detail and examples.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.clear_queued_valves</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
<section id="sprinkler-set-multiplier-action">
<span id="sprinkler-controller-action-set-multiplier"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.set_multiplier</span></code> action<a class="headerlink" href="#sprinkler-set-multiplier-action" title="Permalink to this heading">¶</a></h3>
<p>Sets the multiplier value used to proportionally increase or decrease the run duration for all valves/zones.
For seasonal changes, it’s easier to use the multiplier to adjust the watering time instead of adjusting the
run durations directly. Set your run duration to the time you want for ‘mild’ weather (spring/autumn) and then
use the multiplier to increase (summer) or decrease (winter) the calculated run times. When a given valve is
activated, this value is multiplied by the valve’s run duration (see below) to determine the valve’s actual
run duration. <em>Note that a multiplier value of zero is allowed; if the multiplier value is zero, the
sprinkler controller will not start any valves.</em> <strong>This can result in confusing/unexpected behavior if
a visual indication of this condition is not available!</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.set_multiplier</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">        </span><span class="nt">multiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.5</span>
</pre></div>
</div>
</section>
<section id="sprinkler-set-repeat-action">
<span id="sprinkler-controller-action-set-repeat"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.set_repeat</span></code> action<a class="headerlink" href="#sprinkler-set-repeat-action" title="Permalink to this heading">¶</a></h3>
<p>Specifies the number of times full cycles should be repeated. <strong>Note that the total number of cycles
the controller will run is equal to the repeat value plus one.</strong> For example, with a <code class="docutils literal notranslate"><span class="pre">repeat</span></code> value
of 1, the initial cycle will run, then the repeat cycle will run, resulting in a total of two cycles.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.set_repeat</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">        </span><span class="nt">repeat</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">  </span><span class="c1"># would run three cycles</span>
</pre></div>
</div>
</section>
<section id="sprinkler-set-divider-action">
<span id="sprinkler-controller-action-set-divider"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.set_divider</span></code> action<a class="headerlink" href="#sprinkler-set-divider-action" title="Permalink to this heading">¶</a></h3>
<p>The divider value sets both the multiplier and repeat values as follows:</p>
<ul class="simple">
<li><p>The multiplier value is set to the value of 1 / <code class="docutils literal notranslate"><span class="pre">divider</span></code></p></li>
<li><p>The repeat value is set to <code class="docutils literal notranslate"><span class="pre">divider</span></code> - 1</p></li>
</ul>
<p>As an example, given a divider value of 4, the multiplier would be set to 0.25 and the repeat value
would be set to 3.</p>
<p>This can be useful for dividing the run duration for each valve into multiple shorter cycles, therefore
avoiding run-off by allowing the ground more time to absorb the water.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.set_divider</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">        </span><span class="nt">divider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
</section>
<section id="sprinkler-set-valve-run-duration-action">
<span id="sprinkler-controller-action-set-valve-run-duration"></span><h3><code class="docutils literal notranslate"><span class="pre">sprinkler.set_valve_run_duration</span></code> action<a class="headerlink" href="#sprinkler-set-valve-run-duration-action" title="Permalink to this heading">¶</a></h3>
<p>Sets the run duration for the specified valve. When the valve is activated, this value is multiplied
by the multiplier value (see above) to determine the valve’s actual run duration.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">on_...</span><span class="p">:</span>
<span class="w">  </span><span class="nt">then</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.set_valve_run_duration</span><span class="p">:</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">        </span><span class="nt">valve_number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600s</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">start_single_valve</span></code> action ignores whether a valve is enabled via its enable switch.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">next_valve</span></code> and <code class="docutils literal notranslate"><span class="pre">previous_valve</span></code> actions may not appear to respond immediately if either
<code class="docutils literal notranslate"><span class="pre">manual_selection_delay</span></code> or any of the various delay mechanisms described in the
<a class="reference internal" href="#sprinkler-controller-pump-and-distribution-valve-coordination"><span class="std std-ref">Pump and Distribution Valve Coordination</span></a> section below are configured.
If you are using any of these configuration options, be sure to allow the delay intervals to elapse
before assuming something isn’t working!</p></li>
<li><p>If a valve is active when its <code class="docutils literal notranslate"><span class="pre">run_duration</span></code> or the multiplier value is changed, the active
valve’s run duration will remain unaffected until the next time it is started.</p></li>
</ul>
</div>
</section>
</section>
<section id="pump-and-distribution-valve-coordination">
<span id="sprinkler-controller-pump-and-distribution-valve-coordination"></span><h2>Pump and Distribution Valve Coordination<a class="headerlink" href="#pump-and-distribution-valve-coordination" title="Permalink to this heading">¶</a></h2>
<p>The sprinkler controller allows extensive flexibility relating to the switching of pumps and valves.
Let’s take a closer look at how to use these features to tune your system.</p>
<section id="delayed-starting-and-or-stopping-of-pumps-or-valves">
<h3>Delayed Starting and/or Stopping of Pumps or Valves<a class="headerlink" href="#delayed-starting-and-or-stopping-of-pumps-or-valves" title="Permalink to this heading">¶</a></h3>
<p>For systems with pumps, it’s generally a bad idea to run the pump with no distribution valves open.
This causes pressure to build up and can even destroy the pump after some time. For systems with (a)
pump(s), you’ll likely want to add two configuration options:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">pump_start_pump_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
<span class="w">    </span><span class="nt">pump_stop_valve_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>This will cause any given pump to start (in this example) three seconds <em>after</em> any associated distribution
valve is opened. In addition, it will wait three seconds to close the <em>last</em> distribution valve <em>after</em>
the pump is stopped. This would allow the pump to spin down, pressure to drop and lines to drain prior
to switching off the (last) associated distribution valve. (In these configurations, it might also be
desirable to enable <code class="docutils literal notranslate"><span class="pre">valve_overlap</span></code>, as well – more on this below.)</p>
<p>Some types of electric valves require sufficient water pressure to (fully/quickly) close. These types of
valves, when coupled with electric valves upstream of distribution valves (often known in the industry as
“main” or “master” valves), may require that the upstream valve is switched on <em>before</em> any given distribution
valve(s), allowing the water pressure to stabilize and force all distribution valves closed <em>before</em> any single
distribution valve is opened. In these situations, the reverse of the above configuration may be desirable:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">pump_start_valve_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
<span class="w">    </span><span class="nt">pump_stop_pump_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>In this example, the upstream valve would open three seconds prior to any given associated distribution
valve, allowing the water pressure to force any attached distribution valves closed. After the delay, the
required distribution valve is opened and the cycle starts. When the cycle is complete, the (last) distribution
valve would be switched off three seconds prior to the upstream valve. (In these configurations, it might also
be desirable to enable <code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code>, as well.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">pump_stop_valve_delay</span></code> or <code class="docutils literal notranslate"><span class="pre">pump_stop_pump_delay</span></code> with <code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code> and
<code class="docutils literal notranslate"><span class="pre">pump_switch_off_during_valve_open_delay</span></code> may increase the off-time inserted between the operation
of each zone, as the controller must wait for a given zone (pump <em>and</em> valve) to fully shut down before
it can be started again.</p>
</div>
</section>
<section id="banging-pipes-or-valves-that-don-t-consistently-close">
<h3>Banging Pipes or Valves That Don’t Consistently Close<a class="headerlink" href="#banging-pipes-or-valves-that-don-t-consistently-close" title="Permalink to this heading">¶</a></h3>
<p>A common complaint people have with sprinkler systems is that of banging pipes. In other, less common situations,
some systems suffer from valves that do not (fully/quickly) close. There are three controller options available to
address either of these complaints/concerns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">valve_overlap</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pump_switch_off_during_valve_open_delay</span></code></p></li>
</ul>
<p>The first option, <code class="docutils literal notranslate"><span class="pre">valve_overlap</span></code>, causes the current valve and the next valve (as the controller is iterating
through valves) to run simultaneously for the duration specified. The idea here is that this causes a reduction
in water pressure as the next zone starts up, therefore minimizing banging pipes (aka the “water hammer” effect)
when the valve that is finishing up finally closes.</p>
<p>The second and third options may be used to ensure sufficient water pressure is available to force valves closed.
This may be useful for pressure-sensitive valves that don’t quickly and/or fully close when water pressure is low.</p>
<p>For systems with pumps, it may be desirable to switch off the pump before switching to the next distribution
valve/zone. In these situations, <code class="docutils literal notranslate"><span class="pre">pump_switch_off_during_valve_open_delay</span></code> may prove useful in conjunction
with <code class="docutils literal notranslate"><span class="pre">valve_open_delay</span></code>.</p>
<p>In any case, the examples in the next section illustrate how/where to add these options into your configuration.</p>
</section>
</section>
<section id="controller-examples">
<span id="sprinkler-controller-examples"></span><h2>Controller Examples<a class="headerlink" href="#controller-examples" title="Permalink to this heading">¶</a></h2>
<section id="single-controller-single-valve-no-pump">
<h3>Single Controller, Single Valve, No Pump<a class="headerlink" href="#single-controller-single-valve-no-pump" title="Permalink to this heading">¶</a></h3>
<p>This first example illustrates a complete, single-valve system with no pump/upstream valve(s). It
could be useful for controlling a single valve independent of any other sprinkler controllers. A pump
could easily be added by adding the <code class="docutils literal notranslate"><span class="pre">pump_switch_id</span></code> parameter and a <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">esphome</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp-sprinkler-controller</span>
<span class="w">    </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ESP32</span>
<span class="w">    </span><span class="nt">board</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">featheresp32</span>

<span class="nt">wifi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ssid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_ssid&quot;</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_password&quot;</span>

<span class="nt">logger</span><span class="p">:</span>

<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Flower</span><span class="nv"> </span><span class="s">Garden&quot;</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_valve</span>

<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_valve</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
</section>
<section id="single-controller-three-valves-no-pump">
<h3>Single Controller, Three Valves, No Pump<a class="headerlink" href="#single-controller-three-valves-no-pump" title="Permalink to this heading">¶</a></h3>
<p>This example illustrates a complete, simple three-valve system with no pump/upstream valve(s):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">esphome</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp-sprinkler-controller</span>
<span class="w">    </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ESP32</span>
<span class="w">    </span><span class="nt">board</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">featheresp32</span>

<span class="nt">wifi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ssid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_ssid&quot;</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_password&quot;</span>

<span class="nt">logger</span><span class="p">:</span>

<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">    </span><span class="nt">auto_advance_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Auto</span><span class="nv"> </span><span class="s">Advance&quot;</span>
<span class="w">    </span><span class="nt">reverse_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Reverse&quot;</span>
<span class="w">    </span><span class="nt">multiplier_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinkler</span><span class="nv"> </span><span class="s">Multiplier&quot;</span>
<span class="w">    </span><span class="nt">repeat_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinkler</span><span class="nv"> </span><span class="s">Repeat&quot;</span>
<span class="w">    </span><span class="nt">valve_overlap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">run_duration_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Yard</span><span class="nv"> </span><span class="s">Run</span><span class="nv"> </span><span class="s">Duration&quot;</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">run_duration_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Yard</span><span class="nv"> </span><span class="s">Run</span><span class="nv"> </span><span class="s">Duration&quot;</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">run_duration_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Yard</span><span class="nv"> </span><span class="s">Run</span><span class="nv"> </span><span class="s">Duration&quot;</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2</span>

<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
</section>
<section id="single-controller-three-valves-single-pump">
<h3>Single Controller, Three Valves, Single Pump<a class="headerlink" href="#single-controller-three-valves-single-pump" title="Permalink to this heading">¶</a></h3>
<p>This example illustrates a complete three-valve system with a single pump/upstream valve:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">esphome</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp-sprinkler-controller</span>
<span class="w">    </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ESP32</span>
<span class="w">    </span><span class="nt">board</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">featheresp32</span>

<span class="nt">wifi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ssid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_ssid&quot;</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_password&quot;</span>

<span class="nt">logger</span><span class="p">:</span>

<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">    </span><span class="nt">auto_advance_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Auto</span><span class="nv"> </span><span class="s">Advance&quot;</span>
<span class="w">    </span><span class="nt">reverse_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Reverse&quot;</span>
<span class="w">    </span><span class="nt">valve_open_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2</span>

<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
</section>
<section id="single-controller-three-latching-valves-single-latching-pump">
<h3>Single Controller, Three Latching Valves, Single Latching Pump<a class="headerlink" href="#single-controller-three-latching-valves-single-latching-pump" title="Permalink to this heading">¶</a></h3>
<p>This example is similar to the previous example, however it illustrates how a “latching” or “pulsed”
valve can be configured. This type of valve requires two <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switches</span></a> to
operate – one to switch the valve on and one to switch the valve off. To switch on the valve, the
“on” <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> is switched on for the configured duration and then switched
off. To switch the valve off, the “off” <a class="reference internal" href="switch/gpio.html"><span class="doc">GPIO switch</span></a> is switched on for the
configured duration and then switched off.</p>
<p>Note that, while this example illustrates a configuration that uses exclusively latching valves,
latching and non-latching valves may be mixed and matched in any configuration, even if attached to
a common pump/upstream valve.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">esphome</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp-sprinkler-controller</span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ESP32</span>
<span class="w">  </span><span class="nt">board</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">featheresp32</span>

<span class="nt">wifi</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ssid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_ssid&quot;</span>
<span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_password&quot;</span>

<span class="nt">logger</span><span class="p">:</span>

<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">    </span><span class="nt">auto_advance_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Auto</span><span class="nv"> </span><span class="s">Advance&quot;</span>
<span class="w">    </span><span class="nt">queue_enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Queue</span><span class="nv"> </span><span class="s">Enable&quot;</span>
<span class="w">    </span><span class="nt">reverse_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Reverse&quot;</span>
<span class="w">    </span><span class="nt">pump_pulse_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250ms</span>
<span class="w">    </span><span class="nt">valve_pulse_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">250ms</span>
<span class="w">    </span><span class="nt">valve_open_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_off_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_off</span>
<span class="w">        </span><span class="nt">pump_on_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_on</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_off_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0_off</span>
<span class="w">        </span><span class="nt">valve_on_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0_on</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_off_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_off</span>
<span class="w">        </span><span class="nt">pump_on_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_on</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_off_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1_off</span>
<span class="w">        </span><span class="nt">valve_on_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1_on</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_off_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_off</span>
<span class="w">        </span><span class="nt">pump_on_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_on</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_off_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2_off</span>
<span class="w">        </span><span class="nt">valve_on_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2_on</span>

<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_off</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">14</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw_on</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0_off</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0_on</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1_off</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1_on</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2_off</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2_on</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13</span>
</pre></div>
</div>
</section>
<section id="dual-controller-five-valves-two-pumps">
<h3>Dual Controller, Five Valves, Two Pumps<a class="headerlink" href="#dual-controller-five-valves-two-pumps" title="Permalink to this heading">¶</a></h3>
<p>This example illustrates a complete and more complex dual-controller system with a total of five
valves (three on the first controller and two on the second controller) and two pumps/upstream
valves, each of which are shared between the two controllers:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">esphome</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp-sprinkler-controller</span>
<span class="w">    </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ESP32</span>
<span class="w">    </span><span class="nt">board</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">featheresp32</span>

<span class="nt">wifi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ssid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_ssid&quot;</span>
<span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;wifi_password&quot;</span>

<span class="nt">logger</span><span class="p">:</span>

<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">    </span><span class="nt">auto_advance_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Auto</span><span class="nv"> </span><span class="s">Advance&quot;</span>
<span class="w">    </span><span class="nt">reverse_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Reverse&quot;</span>
<span class="w">    </span><span class="nt">valve_overlap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Front</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw0</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Side</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw0</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Back</span><span class="nv"> </span><span class="s">Lawn&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw1</span>
<span class="w">        </span><span class="nt">run_duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900s</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Garden</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">    </span><span class="nt">auto_advance_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Garden</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Auto</span><span class="nv"> </span><span class="s">Advance&quot;</span>
<span class="w">    </span><span class="nt">reverse_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Garden</span><span class="nv"> </span><span class="s">Sprinklers</span><span class="nv"> </span><span class="s">Reverse&quot;</span>
<span class="w">    </span><span class="nt">valve_open_delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
<span class="w">    </span><span class="nt">valves</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Garden&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Front</span><span class="nv"> </span><span class="s">Garden&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw0</span>
<span class="w">        </span><span class="nt">run_duration_number</span><span class="p">:</span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_ctrlr_front_run_duration</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Front</span><span class="nv"> </span><span class="s">Garden</span><span class="nv"> </span><span class="s">Run</span><span class="nv"> </span><span class="s">Duration&quot;</span>
<span class="w">          </span><span class="nt">initial_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_valve_sw0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">valve_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Garden&quot;</span>
<span class="w">        </span><span class="nt">enable_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Enable</span><span class="nv"> </span><span class="s">Back</span><span class="nv"> </span><span class="s">Garden&quot;</span>
<span class="w">        </span><span class="nt">pump_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw1</span>
<span class="w">        </span><span class="nt">run_duration_number</span><span class="p">:</span>
<span class="w">          </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_ctrlr_back_run_duration</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Back</span><span class="nv"> </span><span class="s">Garden</span><span class="nv"> </span><span class="s">Run</span><span class="nv"> </span><span class="s">Duration&quot;</span>
<span class="w">          </span><span class="nt">initial_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">unit_of_measurement</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">min</span>
<span class="w">        </span><span class="nt">valve_switch_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_valve_sw1</span>

<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw0</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_pump_sw1</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw0</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw1</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_valve_sw2</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_valve_sw0</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">14</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpio</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">garden_sprinkler_valve_sw1</span>
<span class="w">    </span><span class="nt">pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this final complete configuration example, pump control is split among the two sprinkler
controller instances. This will behave as expected; multiple instances of the controller will
communicate to ensure any given pump is activated and deactivated only as necessary, even when
the controllers are operating simultaneously.</p>
</div>
</section>
<section id="using-the-sprinkler-controller-s-numbers">
<span id="sprinkler-controller-sprinkler-controller-numbers"></span><h3>Using the Sprinkler Controller’s Numbers<a class="headerlink" href="#using-the-sprinkler-controller-s-numbers" title="Permalink to this heading">¶</a></h3>
<p>The sprinkler controller can leverage ESPHome’s/Home Assistant’s <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> component to
make valve run durations easily adjustable from the front end (Home Assistant).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">multiplier_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinkler</span><span class="nv"> </span><span class="s">Multiplier&quot;</span>
<span class="w">    </span><span class="nt">repeat_number</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinkler</span><span class="nv"> </span><span class="s">Repeat&quot;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>An added benefit of using <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> components is that modified valve run durations,
multiplier and repeat values can persist across resets/reboots of the ESP device. If this is your desired behavior, you
should configure the <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> components within your sprinkler controller configuration.</p>
<p>The sprinkler controller’s implementation of the <a class="reference internal" href="number/index.html"><span class="doc">number</span></a> component is based on
ESPHome’s <a class="reference internal" href="number/index.html"><span class="doc">Number Component</span></a>, supporting all of its <a class="reference internal" href="number/index.html#config-number"><span class="std std-ref">configuration variables</span></a> in
addition to a subset of the <a class="reference internal" href="number/template.html"><span class="doc">Template Number Component’s</span></a> configuration variables,
including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initial_value</span></code> (Defaults to 900 for valves, 1 for multiplier, 0 for repeat)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_value</span></code> (Defaults to 86400 for valves, 10 for multiplier and repeat)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_value</span></code> (Defaults to 1 for valves, 0 for multiplier and repeat)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> (Defaults to 1 for valves and repeat, 0.1 for multiplier)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">restore_value</span></code> (Defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code>; set to <code class="docutils literal notranslate"><span class="pre">false</span></code> to always restore <code class="docutils literal notranslate"><span class="pre">initial_value</span></code> at boot)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_action</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unit_of_measurement</span></code> (For run durations only; defaults to <code class="docutils literal notranslate"><span class="pre">s</span></code> for seconds or specify <code class="docutils literal notranslate"><span class="pre">min</span></code> for minutes)</p></li>
</ul>
<p>Here’s a brief example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">multiplier_number</span><span class="p">:</span>
<span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controller_multiplier_number</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinkler</span><span class="nv"> </span><span class="s">Multiplier&quot;</span>
<span class="w">      </span><span class="nt">initial_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.5</span>
<span class="w">      </span><span class="nt">min_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">      </span><span class="nt">max_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">      </span><span class="nt">set_action</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lambda</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;some_function();&quot;</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</section>
<section id="extending-the-sprinkler-controller-s-switches">
<span id="sprinkler-controller-sprinkler-controller-extending-switches"></span><h3>Extending the Sprinkler Controller’s Switches<a class="headerlink" href="#extending-the-sprinkler-controller-s-switches" title="Permalink to this heading">¶</a></h3>
<p>It is worth noting that each of the various switches in the sprinkler controller’s configuration are standard
ESPHome <a class="reference internal" href="switch/index.html#config-switch"><span class="std std-ref">switch</span></a> components. Their configuration may be extended in a manner similar to
the following example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extended switch configuration for &#39;main_switch&#39;</span>
<span class="nt">sprinkler</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr</span>
<span class="w">    </span><span class="nt">main_switch</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lawn</span><span class="nv"> </span><span class="s">Sprinklers&quot;</span>
<span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr_main_switch_id</span>
<span class="w">      </span><span class="nt">on_turn_on</span><span class="p">:</span>
<span class="w">        </span><span class="nt">light.turn_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_light</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>This arrangement is possible for any other switch within the sprinkler controller’s configuration block, with
the exception of <code class="docutils literal notranslate"><span class="pre">pump_off_switch_id</span></code>, <code class="docutils literal notranslate"><span class="pre">pump_on_switch_id</span></code>, <code class="docutils literal notranslate"><span class="pre">pump_switch_id</span></code>, <code class="docutils literal notranslate"><span class="pre">valve_off_switch_id</span></code>,
<code class="docutils literal notranslate"><span class="pre">valve_on_switch_id</span></code> and <code class="docutils literal notranslate"><span class="pre">valve_switch_id</span></code> (because these are the IDs of other switch components already
defined elsewhere in your configuration). In addition, specifying each switch ID enables the ability to refer
to any of the sprinkler controller’s switches from elsewhere in your configuration. Here’s another brief example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Template switch as a secondary main switch</span>
<span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">template</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_switch</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Special</span><span class="nv"> </span><span class="s">Sprinkler</span><span class="nv"> </span><span class="s">Switch&quot;</span>
<span class="w">    </span><span class="nt">on_turn_off</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">switch.turn_off</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr_main_switch_id</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">light.turn_off</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_indicator_light</span>
<span class="w">    </span><span class="nt">on_turn_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">switch.turn_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_ctrlr_main_switch_id</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">light.turn_on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sprinkler_indicator_light</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>While the above example simply illustrates creating a secondary “main” switch, this approach could be extended
to take advantage of other devices such as a moisture <a class="reference internal" href="sensor/index.html#config-sensor"><span class="std std-ref">sensor</span></a> – when the moisture level
is too low (look for <code class="docutils literal notranslate"><span class="pre">on_value</span></code> or <code class="docutils literal notranslate"><span class="pre">on_value_range</span></code>), the sprinkler controller (or a specific valve) could
be activated by calling one of the controller’s start-up actions, such as <code class="docutils literal notranslate"><span class="pre">sprinkler.start_full_cycle</span></code>,
<code class="docutils literal notranslate"><span class="pre">sprinkler.start_from_queue</span></code>, <code class="docutils literal notranslate"><span class="pre">sprinkler.start_single_valve</span></code>, or <code class="docutils literal notranslate"><span class="pre">sprinkler.resume_or_start_full_cycle</span></code>.</p>
</section>
<section id="the-sprinkler-controller-queue">
<span id="sprinkler-controller-sprinkler-controller-queue"></span><h3>The Sprinkler Controller Queue<a class="headerlink" href="#the-sprinkler-controller-queue" title="Permalink to this heading">¶</a></h3>
<p>The queuing mechanism is an unusual feature for a sprinkler controller; it becomes useful as a result of the
extreme flexibility of both ESPHome and Home Assistant. Given the extensive ecosystem of devices available today,
the sprinkler controller’s queuing mechanism provides an advanced feature aimed at allowing even more advanced automation.</p>
<p>In general, it comes down to flexibility: the more traditional “run full cycle” and “run single valve” functionality
is intended for use by humans (via the front end or physical control interface) while the queuing mechanism is aimed
at supporting automation.</p>
<p>Here’s a practical example:</p>
<p>Consider a home with a yard divided into a number of sprinkler zones – perhaps it even includes a garden or two
(flowers and vegetables, of course!). An array of soil moisture sensors could be deployed throughout the various
zones and gardens and when a given sensor falls below some defined threshold, that sensor’s zone is entered into
the sprinkler controller’s queue.</p>
<p>Then, each morning at some specific hour, Home Assistant (or even the ESP device itself!) calls the sprinkler
controller’s <code class="docutils literal notranslate"><span class="pre">sprinkler.start_from_queue</span></code> action, causing the controller to iterate only through queued zones.
Because the run duration may be specified as a part of the queue request, this could be extended to compute a
specific run duration for each zone depending on the specific moisture level of the soil on any given day. The
possibilities are endless and are only limited by your creativity!</p>
<p>It is important to note that, if <em>both</em> the auto-advance and queue switches are turned on/enabled, <strong>queued valves
take precedence over valves that would run as a part of a full cycle of the system.</strong> In other words, if the queue
is enabled and a valve is entered into the queue while a full cycle is active, at the next valve transition, the
queue entry will be picked up <em>before</em> the next valve that would run as a part of the full cycle. At present, this
behavior cannot be changed. It should also be noted that the queue has a hard-coded limit of 100 entries to limit
memory use.</p>
</section>
<section id="expose-sprinkler-controller-actions-via-user-api">
<h3>Expose Sprinkler Controller Actions via user-API<a class="headerlink" href="#expose-sprinkler-controller-actions-via-user-api" title="Permalink to this heading">¶</a></h3>
<p>This configuration snippet illustrates how user-defined ESPHome API services may be used to expose
various sprinkler controller actions to the front end. This could be useful to change settings
and/or trigger sprinkler controller actions using automations.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">api</span><span class="p">:</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">set_multiplier</span>
<span class="w">      </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">        </span><span class="nt">multiplier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">float</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.set_multiplier</span><span class="p">:</span>
<span class="w">            </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">            </span><span class="nt">multiplier</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&#39;return</span><span class="nv"> </span><span class="s">multiplier;&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start_full_cycle</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.start_full_cycle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start_single_valve</span>
<span class="w">      </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">        </span><span class="nt">valve</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.start_single_valve</span><span class="p">:</span>
<span class="w">            </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">            </span><span class="nt">valve_number</span><span class="p">:</span><span class="w"> </span><span class="kt">!lambda</span><span class="w"> </span><span class="s">&#39;return</span><span class="nv"> </span><span class="s">valve;&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">next_valve</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.next_valve</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">previous_valve</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.previous_valve</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shutdown</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sprinkler.shutdown</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lawn_sprinkler_ctrlr</span>
</pre></div>
</div>
</section>
</section>
<section id="understanding-the-sprinkler-controller-s-state">
<span id="sprinkler-controller-sprinkler-controller-understanding-state"></span><h2>Understanding the Sprinkler Controller’s State<a class="headerlink" href="#understanding-the-sprinkler-controller-s-state" title="Permalink to this heading">¶</a></h2>
<p>A number of people have asked about how to determine the sprinkler controller’s state. This section aims to outline how
to use the sprinkler controller’s <a class="reference external" href="/api/sprinkler_8h.html">API </a> to determine what it is doing, generally with
the goal of indicating this on some form of <a class="reference internal" href="display/index.html"><span class="doc">display</span></a> hardware. Note that this
discussion largely revolves around C++ code (as is used in ESPHome lambdas).</p>
<p>Many of the methods used to determine the sprinkler controller’s state return a type of value known as an <code class="docutils literal notranslate"><span class="pre">optional</span></code>.
If you are curious, a general reference for the <code class="docutils literal notranslate"><span class="pre">optional</span></code> type may be found
<a class="reference external" href="https://en.cppreference.com/w/cpp/utility/optional">here</a>, but what is important for now is:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">optional</span></code> type <em>may</em> or <em>may not</em> contain a value</p>
<ul>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">has_value()</span></code> is used to determine if a value is present. For example:
<code class="docutils literal notranslate"><span class="pre">id(lawn_sprinkler_ctrlr).active_valve().has_value()</span></code></p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">value()</span></code> is used to determine the value, <em>if</em> it is determined that a value is present. For example:
<code class="docutils literal notranslate"><span class="pre">auto</span> <span class="pre">running_valve</span> <span class="pre">=</span> <span class="pre">id(lawn_sprinkler_ctrlr).active_valve().value()</span></code></p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">optional</span></code> type can contain a value of any C++ type (<code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, etc.) (In C++ terms, it is a
template.)</p></li>
</ul>
<p>The examples that follow illustrate use of the the sprinkler controller’s methods within a
<a class="reference internal" href="display/index.html"><span class="doc">display</span></a> lambda. The examples are intended to illustrate a pattern and (for sake of
brevity) <em>are not complete</em>; at very least you’ll need to fill out the <a class="reference internal" href="display/index.html"><span class="doc">display</span></a>
component’s specific configuration details before you can use them.</p>
<p>With these points in mind, let’s discuss some of the methods which indicate the state of the sprinkler controller.
We’ll approach this from the angle of <em>“how do I…”</em></p>
<section id="how-do-i">
<span id="sprinkler-controller-sprinkler-controller-understanding-state-how-do-i"></span><h3>How Do I…<a class="headerlink" href="#how-do-i" title="Permalink to this heading">¶</a></h3>
<ul>
<li><p><strong>…determine if the sprinkler controller is running?</strong></p>
<p>Use the method <code class="docutils literal notranslate"><span class="pre">optional&lt;size_t&gt;</span> <span class="pre">active_valve()</span></code> to check if there is an active valve. If the <code class="docutils literal notranslate"><span class="pre">optional</span></code> returned
<code class="docutils literal notranslate"><span class="pre">has_value()</span></code>, the sprinkler controller is running and you may use the <code class="docutils literal notranslate"><span class="pre">value()</span></code> method to check which specific
valve is active.</p>
<p><em>Example:</em></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">display</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">platform</span><span class="o">:</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="cp"># ...display configuration...</span>
<span class="w">    </span><span class="nl">lambda</span><span class="p">:</span><span class="w"> </span><span class="o">|-</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">active_valve</span><span class="p">().</span><span class="n">has_value</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// the controller is running, get the active valve into running_valve and print it</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">running_valve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">active_valve</span><span class="p">().</span><span class="n">value</span><span class="p">();</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Valve %u active&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">running_valve</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// the controller is NOT running</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Idle&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>…determine if the sprinkler controller is paused and, if so, which valve is paused?</strong></p>
<p>Use the method <code class="docutils literal notranslate"><span class="pre">optional&lt;size_t&gt;</span> <span class="pre">paused_valve()</span></code> to check if there is a paused valve. If the <code class="docutils literal notranslate"><span class="pre">optional</span></code> returned
<code class="docutils literal notranslate"><span class="pre">has_value()</span></code>, the sprinkler controller is paused and you may use the <code class="docutils literal notranslate"><span class="pre">value()</span></code> method to check which specific
valve is paused. In general, this follows the same pattern as the
<a class="reference internal" href="#sprinkler-controller-sprinkler-controller-understanding-state-how-do-i"><span class="std std-ref">active_valve() example above</span></a>.</p>
</li>
<li><p><strong>…determine the sprinkler controller’s current mode?</strong></p>
<p>If by this you mean, “is auto-advance/the queue/reverse/standby enabled?”, you are in the right spot. Methods exist
for just this purpose:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">auto_advance()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">queue_enabled()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">reverse()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">standby()</span></code></p></li>
</ul>
<p>Each will return <code class="docutils literal notranslate"><span class="pre">true</span></code> if the respective “mode” is enabled.</p>
<p><em>Examples:</em></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">display</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">platform</span><span class="o">:</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="cp"># ...display configuration...</span>
<span class="w">    </span><span class="nl">lambda</span><span class="p">:</span><span class="w"> </span><span class="o">|-</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">auto_advance</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// auto-advance is enabled</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Auto-advance enabled&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// auto-advance is NOT enabled</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Auto-advance disabled&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">queue_enabled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// queue is enabled</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Queue enabled&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// queue is NOT enabled</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Queue disabled&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>…determine the sprinkler controller’s multiplier/repeat values?</strong></p>
<p>Methods of interest in this case are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">multiplier()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optional&lt;uint32_t&gt;</span> <span class="pre">repeat()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optional&lt;uint32_t&gt;</span> <span class="pre">repeat_count()</span></code></p></li>
</ul>
<p>Note again that each of the <code class="docutils literal notranslate"><span class="pre">repeat</span></code> methods returns an <code class="docutils literal notranslate"><span class="pre">optional</span></code> type; if the <code class="docutils literal notranslate"><span class="pre">optional</span></code> returned
<code class="docutils literal notranslate"><span class="pre">has_value()</span></code>, repeating is enabled and you can get the repeat target (<code class="docutils literal notranslate"><span class="pre">repeat()</span></code>) or current repeat
count (<code class="docutils literal notranslate"><span class="pre">repeat_count()</span></code>) with <code class="docutils literal notranslate"><span class="pre">optional</span></code>’s <code class="docutils literal notranslate"><span class="pre">value()</span></code> method.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">multiplier()</span></code> method returns a <code class="docutils literal notranslate"><span class="pre">float</span></code> type and, as such, it always has a value.</p>
<p><em>Examples:</em></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">display</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">platform</span><span class="o">:</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="cp"># ...display configuration...</span>
<span class="w">    </span><span class="nl">lambda</span><span class="p">:</span><span class="w"> </span><span class="o">|-</span>
<span class="w">      </span><span class="n">it</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Multiplier: %f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">multiplier</span><span class="p">());</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">repeat</span><span class="p">().</span><span class="n">has_value</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// the controller is repeating, print the repeat target value</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Repeat %u times&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">repeat</span><span class="p">().</span><span class="n">value</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>…determine how much time is left/required?</strong></p>
<p>Several methods are available for this purpose:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">total_cycle_time_all_valves()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">total_cycle_time_enabled_valves()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">total_cycle_time_enabled_incomplete_valves()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uint32_t</span> <span class="pre">total_queue_time()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optional&lt;uint32_t&gt;</span> <span class="pre">time_remaining_active_valve()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optional&lt;uint32_t&gt;</span> <span class="pre">time_remaining_current_operation()</span></code></p></li>
</ul>
<p>Note that, as with several of the earlier examples, the <code class="docutils literal notranslate"><span class="pre">time_remaining_...</span></code> methods each return an <code class="docutils literal notranslate"><span class="pre">optional</span></code>
type. If the <code class="docutils literal notranslate"><span class="pre">optional</span></code> returned <code class="docutils literal notranslate"><span class="pre">has_value()</span></code>, a valve is active/running; if it does not <code class="docutils literal notranslate"><span class="pre">has_value()</span></code>, no
valve is active, meaning the controller is idle.</p>
<p><em>Example:</em></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="nl">display</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">platform</span><span class="o">:</span><span class="w"> </span><span class="p">...</span>
<span class="w">    </span><span class="cp"># ...display configuration...</span>
<span class="w">    </span><span class="nl">lambda</span><span class="p">:</span><span class="w"> </span><span class="o">|-</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">time_remaining_active_valve</span><span class="p">().</span><span class="n">has_value</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// the controller is running, print the number of seconds remaining</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Time left: %u sec.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">lawn_sprinkler_ctrlr</span><span class="p">).</span><span class="n">time_remaining_active_valve</span><span class="p">().</span><span class="n">value</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// the controller is NOT running</span>
<span class="w">        </span><span class="n">it</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Idle&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="/api/sprinkler_8h.html">API Reference</a></p></li>
<li><p><a class="reference external" href="/api/switch_8h.html">API Reference</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/sprinkler.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been release since you last visited this page: 2023.8.3 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2023.8.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2023.8");
    } else if (old !== "2023.8") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2023.8");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>