
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up XPT2046 touch screen controller with ESPHome">
<meta name="keywords" content="XPT2046">
<meta itemprop="name" content="XPT2046 Touch Screen Controller (Updated version)">
<meta itemprop="description" content="Instructions for setting up XPT2046 touch screen controller with ESPHome">
<meta itemprop="image" content="https://esphome.io/_images/xpt2046.jpg">
<meta name="twitter:title" content="XPT2046 Touch Screen Controller (Updated version)">
<meta name="twitter:image:src" content="https://esphome.io/_images/xpt2046.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up XPT2046 touch screen controller with ESPHome">
<meta property="og:title" content="XPT2046 Touch Screen Controller (Updated version)">
<meta property="og:image" content="https://esphome.io/_images/xpt2046.jpg">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up XPT2046 touch screen controller with ESPHome">

    <title>XPT2046 Touch Screen Controller (Updated version) &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../_static/pygments_dark.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/touchscreen/xpt2046.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lock Component" href="../lock/index.html" />
    <link rel="prev" title="TT21100 Touch Screen Controller" href="tt21100.html" />
  <link rel="stylesheet" href="../../_static/custom.css?hash=ab494674" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo-text.svg" alt="Logo"/>
            </a></p><link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>

<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>

  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">XPT2046 Touch Screen Controller (Updated version)</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
<li><a class="reference internal" href="#calibration">Calibration</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  
  <ul class="breadcrumbs">
      <li><a href="../index.html">Components</a> ➔</li>
      <li><a href="index.html">Touchscreen Components</a> ➔</li>
      <li>XPT2046 Touch Screen Controller (Updated version)</li>
  </ul>
  


          <div class="body" role="main">
            
  <section id="xpt2046-touch-screen-controller-updated-version">
<h1>XPT2046 Touch Screen Controller (Updated version)<a class="headerlink" href="#xpt2046-touch-screen-controller-updated-version" title="Permalink to this heading">¶</a></h1>
<p id="xpt2046-component">The <code class="docutils literal notranslate"><span class="pre">xpt2046</span></code> touchscreen platform allows using the touch screen controllers
based on the XPT2046 chip
(<a class="reference external" href="https://datasheetspdf.com/pdf-file/746665/XPTEK/XPT2046/1">datasheet</a>,
<a class="reference external" href="https://www.az-delivery.de/en/products/2-4-tft-lcd-touch-display">AZ-Delivery</a>) with ESPHome. Many cheap LCD displays contain this controller.
The <a class="reference internal" href="../spi.html#spi"><span class="std std-ref">SPI</span></a> is required to be set up in your configuration for this sensor to work.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/xpt2046-full.jpg"><img alt="../../_images/xpt2046-full.jpg" src="../../_images/xpt2046-full.jpg" style="width: 50.0%;" /></a>
<figcaption>
<p><span class="caption-text">XPT2046 Touch Screen Controller</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example configuration entry</span>
<span class="nt">touchscreen</span><span class="p">:</span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xpt2046</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_touchscreen</span>
<span class="w">  </span><span class="nt">cs_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">17</span>
<span class="w">  </span><span class="nt">interrupt_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">  </span><span class="nt">update_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50ms</span>
<span class="w">  </span><span class="nt">report_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span>
<span class="w">  </span><span class="nt">threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">400</span>
<span class="w">  </span><span class="nt">calibration_x_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3860</span>
<span class="w">  </span><span class="nt">calibration_x_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">280</span>
<span class="w">  </span><span class="nt">calibration_y_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">340</span>
<span class="w">  </span><span class="nt">calibration_y_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3860</span>
<span class="w">  </span><span class="nt">swap_x_y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<section id="configuration-variables">
<h2>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¶</a></h2>
<p>The configuration is made up of two parts: The touch screen component, and optional individual binary sensors.</p>
<p>Base Configuration:</p>
<ul class="simple">
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Set the ID of this sensor.</p></li>
<li><p><strong>cs_pin</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The chip select pin.
Often marked <code class="docutils literal notranslate"><span class="pre">T_CS</span></code> on the board.</p></li>
<li><p><strong>interrupt_pin</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-pin-schema"><span class="std std-ref">Pin Schema</span></a>): The touch detection pin.
Often marked <code class="docutils literal notranslate"><span class="pre">T_IRQ</span></code> on the board. If not specified the component will use polling
via SPI. This key is renamed from <strong>irq_pin</strong></p></li>
<li><p><strong>update_interval</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The interval to check the
sensor. If <code class="docutils literal notranslate"><span class="pre">interrupt_pin</span></code> is specified the touch will be detected nearly instantaneously and this setting
will be used only for the release detection. Defaults to <code class="docutils literal notranslate"><span class="pre">50ms</span></code>.</p></li>
<li><p><strong>report_interval</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-time"><span class="std std-ref">Time</span></a>): The interval to periodically
report the coordinates while the touch screen is touched. Defaults to <code class="docutils literal notranslate"><span class="pre">never</span></code>.</p></li>
<li><p><strong>threshold</strong> (<em>Optional</em>, int): The value to detect the touch or release. Defaults to <code class="docutils literal notranslate"><span class="pre">400</span></code>.</p></li>
<li><p><strong>calibration_x_min</strong> (<em>Optional</em>, int): The raw value corresponding to the left
(or top if <code class="docutils literal notranslate"><span class="pre">swap_x_y</span></code> is specified) edge of the display. See <a class="reference internal" href="#xpt2046-calibration"><span class="std std-ref">Calibration</span></a>
for the process to calibrate the touch screen. Defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>calibration_x_max</strong> (<em>Optional</em>, int): The raw value corresponding to the right
(or bottom if <code class="docutils literal notranslate"><span class="pre">swap_x_y</span></code> is specified) edge of the display. Defaults to <code class="docutils literal notranslate"><span class="pre">4095</span></code>.</p></li>
<li><p><strong>calibration_y_min</strong> (<em>Optional</em>, int): The raw value corresponding to the top
(or left if <code class="docutils literal notranslate"><span class="pre">swap_x_y</span></code> is specified) edge of the display. Defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>calibration_y_max</strong> (<em>Optional</em>, int): The raw value corresponding to the bottom
(or right if <code class="docutils literal notranslate"><span class="pre">swap_x_y</span></code> is specified) edge of the display. Defaults to <code class="docutils literal notranslate"><span class="pre">4095</span></code>.</p></li>
<li><p><strong>swap_x_y</strong> (<em>Optional</em>, boolean): If true the x and y axes are swapped. Defaults to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p>All other options from <a class="reference internal" href="index.html#config-touchscreen"><span class="std std-ref">Base Touchscreen Configuration</span></a>.</p></li>
</ul>
</section>
<section id="calibration">
<span id="xpt2046-calibration"></span><h2>Calibration<a class="headerlink" href="#calibration" title="Permalink to this heading">¶</a></h2>
<p>To match the point of the touch to the display coordinates the touch screen has to be calibrated.
The XPT2046 component returns raw values in the 0 to 4095 range. Those raw values are available
as the <code class="docutils literal notranslate"><span class="pre">x_raw</span></code> and <code class="docutils literal notranslate"><span class="pre">y_raw</span></code> member variables and for example write them out as in the example
<a class="reference internal" href="index.html#touchscreen-on-touch"><span class="std std-ref">on_touch Trigger</span></a>. The goal of the calibration is to identify the raw values corresponding
to the edges of the screen.</p>
<p>The calibration assumes a display oriented in a way that you will be using it, i.e. your
<a class="reference internal" href="../display/index.html#display-engine"><span class="std std-ref">Display Rendering Engine</span></a> component has to have the [0,0] logical coordinate at the top left.
Set the dimensions as <code class="docutils literal notranslate"><span class="pre">dimension_x</span></code> and <code class="docutils literal notranslate"><span class="pre">dimension_y</span></code> and do not set any calibration
values nor <code class="docutils literal notranslate"><span class="pre">swap_x_y</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Touchscreen</span>
<span class="nt">touchscreen</span><span class="p">:</span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xpt2046</span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_touchscreen</span>
<span class="w">  </span><span class="nt">cs_pin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">17</span>
<span class="w">  </span><span class="nt">on_touch</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">          </span><span class="no">ESP_LOGI(&quot;cal&quot;, &quot;x=%d, y=%d, x_raw=%d, y_raw=%0d&quot;,</span>
<span class="w">              </span><span class="no">id(my_touchscreen).x,</span>
<span class="w">              </span><span class="no">id(my_touchscreen).y,</span>
<span class="w">              </span><span class="no">id(my_touchscreen).x_raw,</span>
<span class="w">              </span><span class="no">id(my_touchscreen).y_raw</span>
<span class="w">              </span><span class="no">);</span>
</pre></div>
</div>
<p>Get a stylus or a similar object, run the project and touch the corners of the screen at
the edge pixels. Repeat several times and note minimum and maximum x and y raw values.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>... top left ...
[21:07:48][I][cal:071]: x=217, y=34, x_raw=3718, y_raw=445
[21:07:49][I][cal:071]: x=222, y=32, x_raw=3804, y_raw=419
... top right ...
[21:07:52][I][cal:071]: x=19, y=36, x_raw=334, y_raw=370
[21:07:52][I][cal:071]: x=22, y=35, x_raw=386, y_raw=347
... bottom left ...
[21:08:00][I][cal:071]: x=224, y=299, x_raw=3836, y_raw=3835
[21:08:00][I][cal:071]: x=225, y=303, x_raw=3848, y_raw=3878
[21:08:01][I][cal:071]: x=223, y=299, x_raw=3807, y_raw=3829
... bottom right ...
[21:08:11][I][cal:071]: x=16, y=299, x_raw=281, y_raw=3839
[21:08:12][I][cal:071]: x=19, y=302, x_raw=328, y_raw=3866
[21:08:13][I][cal:071]: x=20, y=296, x_raw=358, y_raw=3799
</pre></div>
</div>
<p>That means that the minimum raw x is 281, maximum 3848, minimum y 347 and maximum 3878.</p>
<p>Identify which raw value is the display’s x direction and what the y one. In our case
moving right decreases the x raw value and going down increases the y one so the axes
match and we <em>don’t</em> need to use <code class="docutils literal notranslate"><span class="pre">swap_x_y</span></code>. If the raw x is the display’s y,
use <code class="docutils literal notranslate"><span class="pre">swap_x_y</span> <span class="pre">=</span> <span class="pre">true</span></code>.</p>
<p>If one of the coordinates goes in the “wrong” direction it needs to be inverted.
The inversion is performed by swapping the minimum and maximum values. In our
case the horizontal direction represented by the raw x (no swap) is inverted
so the <code class="docutils literal notranslate"><span class="pre">calibration_x_min</span></code> needs to be larger than <code class="docutils literal notranslate"><span class="pre">calibration_x_max</span></code>.
The vertical direction is fine. The configuration would thus be</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">touchscreen</span><span class="p">:</span>
<span class="w">  </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xpt2046</span>
<span class="w">  </span><span class="nt">calibration_x_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3848</span>
<span class="w">  </span><span class="nt">calibration_x_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">281</span>
<span class="w">  </span><span class="nt">calibration_y_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">347</span>
<span class="w">  </span><span class="nt">calibration_y_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3878</span>
</pre></div>
</div>
<p>Compile, run and click on the edges again. The x and y should now match the coordinates
of the display.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[21:32:34][I][cal:071]: x=7, y=6, x_raw=3755, y_raw=407
[21:32:37][I][cal:071]: x=237, y=4, x_raw=313, y_raw=385
[21:32:43][I][cal:071]: x=239, y=318, x_raw=284, y_raw=3845
[21:33:05][I][cal:071]: x=2, y=313, x_raw=3821, y_raw=3793
</pre></div>
</div>
<p>Note that the touch screen is not extremely precise and there might be nonlinearities
or similar errors so don’t expect a pixel-perfect precision. You can verify the touchpoint
using a display lambda similar to the following.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">display</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ili9341</span>
<span class="w">    </span><span class="nt">lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">it.fill(BLACK);</span>
<span class="w">      </span><span class="no">if (id(my_touchscreen).touched)</span>
<span class="w">        </span><span class="no">it.filled_circle(id(my_touchscreen).x, id(my_touchscreen).y, 10, RED);</span>
</pre></div>
</div>
<p>To be exact, the component does the following</p>
<ul class="simple">
<li><p>reads the raw x and y and normalizes it using (non-inverted) min and max values</p></li>
<li><p>swaps x and y if needed</p></li>
<li><p>inverts if needed</p></li>
<li><p>scales to the display dimensions</p></li>
</ul>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../binary_sensor/index.html#binary-sensor-filters"><span class="std std-ref">Binary Sensor Filters</span></a></p></li>
<li><p><a class="reference external" href="/api/xpt2046_8h.html">API Reference</a></p></li>
<li><p><a class="reference external" href="https://platformio.org/lib/show/542/XPT2046_Touchscreen">XPT2046 Library</a> by <a class="reference external" href="https://github.com/PaulStoffregen">Paul Stoffregen</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/touchscreen/xpt2046.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been release since you last visited this page: 2023.8.3 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2023.8.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2023.8");
    } else if (old !== "2023.8") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2023.8");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>