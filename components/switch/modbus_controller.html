
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up a modbus_controller device sensor.">
<meta itemprop="name" content="Modbus Controller Switch">
<meta itemprop="description" content="Instructions for setting up a modbus_controller device sensor.">
<meta name="twitter:title" content="Modbus Controller Switch">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up a modbus_controller device sensor.">
<meta property="og:title" content="Modbus Controller Switch">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up a modbus_controller device sensor.">

    <title>Modbus Controller Switch &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../_static/pygments_dark.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/switch/modbus_controller.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Nextion Switch Component" href="nextion.html" />
    <link rel="prev" title="GPIO Switch" href="gpio.html" />
  <link rel="stylesheet" href="../../_static/custom.css?hash=ab494674" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo-text.svg" alt="Logo"/>
            </a></p><link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>

<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>

  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Modbus Controller Switch</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  
  <ul class="breadcrumbs">
      <li><a href="../index.html">Components</a> ➔</li>
      <li><a href="index.html">Switch Component</a> ➔</li>
      <li>Modbus Controller Switch</li>
  </ul>
  


          <div class="body" role="main">
            
  <section id="modbus-controller-switch">
<h1>Modbus Controller Switch<a class="headerlink" href="#modbus-controller-switch" title="Permalink to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> switch platform creates a switch from a modbus_controller component
and requires <a class="reference internal" href="../modbus_controller.html"><span class="doc">Modbus Controller</span></a> to be configured.</p>
<section id="configuration-variables">
<h2>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID used for code generation.</p></li>
<li><p><strong>name</strong> (<strong>Required</strong>, string): The name of the sensor.</p></li>
<li><p><strong>restore_mode</strong> (<em>Optional</em>): See <a class="reference internal" href="index.html#config-switch"><span class="std std-ref">Switch</span></a>, since this configuration variable is inherited. The default value for this setting is <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code> (recommended).
<code class="docutils literal notranslate"><span class="pre">DISABLED</span></code> leaves the initial state up to the hardware: usually the state lives in the device and ESPHome does not need to remember it. The switch frontend will show an undetermined
state until the real state is retrieved from the device on the next refresh. Use any other setting if a reboot of your ESPHome device is tied to a reboot of the modbus device.</p></li>
<li><p><strong>register_type</strong> (<strong>Required</strong>): type of the modbus register.</p></li>
<li><p><strong>address</strong> (<strong>Required</strong>, int): start address of the first register in a range</p></li>
<li><p><strong>offset</strong> (<em>Optional</em>, int): not required in most cases
offset from start address in bytes. If more than one register is read a modbus read registers command this value is used to find the start of this datapoint relative to start address. The component calculates the size of the range based on offset and size of the value type
The value for offset depends on the register type. For holding input registers the offset is in bytes. For coil and discrete input resisters the LSB of the first data byte contains the coil addressed in the request. The other coils follow toward the high-order end of this byte and from low order to high order in subsequent bytes. For the registers  offset is the position of the relevant bit.
To get the value of the coil register 2 can be retrieved using address: 2 / offset: 0 or address: 0 / offset 2</p></li>
<li><p><strong>bitmask</strong> (<em>Optional</em>, int): Some values are packed in a response. The bitmask is used to determined if the result is true or false.</p></li>
<li><p><strong>skip_updates</strong> (<em>Optional</em>, int): By default all sensors of a modbus_controller are updated together. For data points that don’t change very frequently updates can be skipped. A value of 5 would only update this sensor range in every 5th update cycle</p></li>
<li><p><strong>use_write_multiple</strong> (<em>Optional</em>, boolean): By default the modbus command <code class="docutils literal notranslate"><span class="pre">Force</span> <span class="pre">Single</span> <span class="pre">Coil</span></code> (function code 5) is used to send state changes to the device. If your device only supports <code class="docutils literal notranslate"><span class="pre">Force</span> <span class="pre">Multiple</span> <span class="pre">Coils</span></code> (function code 15) set this option to true.</p></li>
<li><p><strong>custom_command</strong> (<em>Optional</em>, list of bytes): raw bytes for modbus command. This allows using non-standard commands. If <code class="docutils literal notranslate"><span class="pre">custom_command</span></code> is used <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">register_type</span></code> can’t be used.
custom data must contain all required bytes including the modbus device address. The crc is automatically calculated and appended to the command.
See <a class="reference internal" href="../sensor/modbus_controller.html#modbus-custom-command"><span class="std std-ref">Using custom_command</span></a> how to use <code class="docutils literal notranslate"><span class="pre">custom_command</span></code></p></li>
<li><p><strong>lambda</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/automations.html#config-lambda"><span class="std std-ref">lambda</span></a>):
Lambda to be evaluated every update interval to read the status of the switch.</p></li>
<li><p><strong>write_lambda</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/automations.html#config-lambda"><span class="std std-ref">lambda</span></a>): Lambda called before send.
Lambda is evaluated before the modbus write command is created.</p>
<p>Parameters passed into the lambda</p>
<ul class="simple">
<li><p><strong>x</strong> (float): The float value to be sent to the modbus device</p></li>
<li><p><strong>payload</strong> (<code class="docutils literal notranslate"><span class="pre">std::vector&lt;uint8_t&gt;&amp;payload</span></code>): empty vector for the payload. If payload is set in the lambda it is sent as a custom command and must include all required bytes for a modbus request
<em>note:</em> because the response contains data for all registers in the same range you have to use <code class="docutils literal notranslate"><span class="pre">data[item-&gt;offset]</span></code> to get the first response byte for your sensor.</p></li>
<li><p><strong>item</strong> (const pointer to a Switch derived object):  The sensor object itself.</p></li>
</ul>
<p>Possible return values for the lambda:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;true</span> <span class="pre">/</span> <span class="pre">false&gt;;</span></code> the new value for the sensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;anything&gt;;</span> <span class="pre">and</span> <span class="pre">fill</span> <span class="pre">payload</span> <span class="pre">with</span> <span class="pre">data</span></code> if the payload is added from the lambda then these bytes will be sent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">{};</span></code> in the case the lambda handles the sending of the value itself.</p></li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">switch</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable_load_test</span>
<span class="w">    </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coil</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enable</span><span class="nv"> </span><span class="s">load</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">mode&quot;</span>
<span class="w">    </span><span class="nt">write_lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">ESP_LOGD(&quot;main&quot;,&quot;Modbus Switch incoming state = %f&quot;,x);</span>
<span class="w">      </span><span class="no">// return false ; // use this to just change the value</span>
<span class="w">      </span><span class="no">payload.push_back(0x1);  // device address</span>
<span class="w">      </span><span class="no">payload.push_back(0x5);  // force single coil</span>
<span class="w">      </span><span class="no">payload.push_back(0x00); // high byte address of the coil</span>
<span class="w">      </span><span class="no">payload.push_back(0x6);  // low byte address of the coil</span>
<span class="w">      </span><span class="no">payload.push_back(0xFF); // ON = 0xFF00 OFF=0000</span>
<span class="w">      </span><span class="no">payload.push_back(0x00);</span>
<span class="w">      </span><span class="no">return true;</span>
</pre></div>
</div>
<p><strong>Example</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">switch</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller_id</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable_load_test</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">register_type</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coil</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">address</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;enable</span><span class="nv"> </span><span class="s">load</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">mode&quot;</span>
<span class="w">    </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>Since offset is not zero the read command is part of a range and will be parsed when the range is updated.
The write command to be constructed uses the function code to determine the write command. For a coil it is write single coil.
Because the write command only touches one register start_address and offset have to be corrected.
The final command will be write_single_coil address 5 (start_address+offset) value 1 or 0</p>
<p>For holding registers the write command will be write_single_register. Because the offset for holding registers is given in bytes and the size of a register is 16 bytes the start_address is calculated as <code class="docutils literal notranslate"><span class="pre">start_address</span> <span class="pre">+</span> <span class="pre">offset/2</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">switch</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">  </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ventilation_system</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enable</span><span class="nv"> </span><span class="s">turn</span><span class="nv"> </span><span class="s">off&quot;</span>
<span class="w">  </span><span class="nt">register_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">holding</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<span class="w">  </span><span class="nt">bitmask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">entity_category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">  </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mdi:toggle-switch&quot;</span>
</pre></div>
</div>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../modbus_controller.html"><span class="doc">Modbus Controller</span></a></p></li>
<li><p><a class="reference internal" href="../sensor/modbus_controller.html"><span class="doc">Modbus Controller Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../binary_sensor/modbus_controller.html"><span class="doc">Modbus Controller Binary Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../text_sensor/modbus_controller.html"><span class="doc">Modbus Controller Text Sensor</span></a></p></li>
<li><p><a class="reference external" href="https://www.modbustools.com/modbus.html">https://www.modbustools.com/modbus.html</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/switch/modbus_controller.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been release since you last visited this page: 2023.8.3 🎉
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2023.8.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2023.8");
    } else if (old !== "2023.8") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2023.8");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>