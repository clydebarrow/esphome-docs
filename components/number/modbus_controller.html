
  <!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta name="description" content="Instructions for setting up a modbus_controller device sensor.">
<meta itemprop="name" content="Modbus Controller Number">
<meta itemprop="description" content="Instructions for setting up a modbus_controller device sensor.">
<meta name="twitter:title" content="Modbus Controller Number">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@OttoWinter_">
<meta name="twitter:description" content="Instructions for setting up a modbus_controller device sensor.">
<meta property="og:title" content="Modbus Controller Number">
<meta property="og:type" content="website">
<meta property="og:description" content="Instructions for setting up a modbus_controller device sensor.">

    <title>Modbus Controller Number &#8212; ESPHome</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="../../_static/pygments_dark.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="canonical" href="https://esphome.io/components/number/modbus_controller.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Template Number" href="template.html" />
    <link rel="prev" title="Number Component" href="index.html" />
  <link rel="stylesheet" href="../../_static/custom.css?hash=ab494674" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/_static/apple-touch-icon.png">
  <link rel="shortcut icon" href="/_static/favicon.ico">
  <link rel="icon" type="image/png" sizes="512x512" href="/_static/favicon-512x512.png">
  <link rel="icon" type="image/png" sizes="256x256" href="/_static/favicon-256x256.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/_static/favicon-192x192.png">
  <link rel="icon" type="image/png" sizes="128x128" href="/_static/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/_static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/_static/favicon-16x16.png">
  <link rel="manifest" href="/_static/site.webmanifest">
  <link rel="mask-icon" href="/_static/safari-pinned-tab.svg" color="#646464">
  <meta name="apple-mobile-web-app-title" content="ESPHome">
  <meta name="application-name" content="ESPHome">
  <meta name="msapplication-TileColor" content="#dfdfdf">
  <meta name="msapplication-config" content="/_static/browserconfig.xml">
  <meta name="theme-color" content="#dfdfdf">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta property="og:site_name" content="ESPHome">
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo-text.svg" alt="Logo"/>
            </a></p><link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>

<div id="search"></div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search", showSubResults: true });
    });
</script>

  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Modbus Controller Number</a><ul>
<li><a class="reference internal" href="#configuration-variables">Configuration variables:</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

  </div><hr />
<ul>
    <li><a href="https://discord.gg/KhAMKrd" target="_blank">Join the community</a></li>
    <li><a href="https://twitter.com/esphome_" target="_blank">Follow us on Twitter</a></li>
    <li><a href="https://github.com/esphome/esphome" target="_blank">Source Code</a></li>
    <li><a href="mailto:esphome@nabucasa.com">Contact</a> (no support!)</li>
</ul>
ESPHome is an open source project by <a href="https://www.nabucasa.com" target="_blank">Nabu Casa</a>
<ul>
    <li><a href="https://www.netlify.com" target="_blank">This site is powered by Netlify</a></li>
</ul>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
  
  <ul class="breadcrumbs">
      <li><a href="../index.html">Components</a> âž”</li>
      <li><a href="index.html">Number Component</a> âž”</li>
      <li>Modbus Controller Number</li>
  </ul>
  


          <div class="body" role="main">
            
  <section id="modbus-controller-number">
<h1>Modbus Controller Number<a class="headerlink" href="#modbus-controller-number" title="Permalink to this heading">Â¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">modbus_controller</span></code> platform creates a Number from a modbus_controller.
When the Number is updated a modbus write command is created sent to the device.</p>
<section id="configuration-variables">
<h2>Configuration variables:<a class="headerlink" href="#configuration-variables" title="Permalink to this heading">Â¶</a></h2>
<ul>
<li><p><strong>id</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/configuration-types.html#config-id"><span class="std std-ref">ID</span></a>): Manually specify the ID used for code generation.</p></li>
<li><p><strong>name</strong> (<strong>Required</strong>, string): The name of the sensor.</p></li>
<li><p><strong>address</strong> (<strong>Required</strong>, int): start address of the first register in a range</p></li>
<li><p><strong>value_type</strong> (<strong>Required</strong>): datatype of the mod_bus register data. The default data type for modbus is a 16 bit integer in big endian format (MSB first)</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">U_WORD</span></code> (unsigned 16 bit integer from 1 register = 16bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_WORD</span></code> (signed 16 bit integer from 1 register = 16bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_DWORD</span></code> (unsigned 32 bit integer from 2 registers = 32bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_DWORD</span></code> (signed 32 bit integer from 2 registers = 32bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_DWORD_R</span></code> (unsigned 32 bit integer from 2 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_DWORD_R</span></code> (signed 32 bit integer from 2 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_QWORD</span></code> (unsigned 64 bit integer from 4 registers = 64bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">S_QWORD</span></code> (unsigned 64 bit integer from 4 registers = 64bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_QWORD_R</span></code> (unsigned 64 bit integer from 4 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U_QWORD_R</span></code> signed 64 bit integer from 4 registers low word first)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FP32</span></code> (32 bit IEEE 754 floating point from 2 registers)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FP32_R</span></code> (32 bit IEEE 754 floating point - same as FP32 but low word first)</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>skip_updates</strong> (<em>Optional</em>, int): By default all sensors of a modbus_controller are updated together. For data points that donâ€™t change very frequently updates can be skipped. A value of 5 would only update this sensor range in every 5th update cycle
Note: The modbus_controller groups component by address ranges to reduce number of transactions. All components with the same address will be updated in one request. skip_updates applies for all components in the same range.</p></li>
<li><p><strong>response_size</strong> (<em>Optional</em>): Size of the response for the register in bytes. Defaults to register_count*2.</p></li>
<li><p><strong>force_new_range</strong> (<em>Optional</em>, boolean): If possible sensors with sequential addresses are grouped together and requested in one range. Setting <code class="docutils literal notranslate"><span class="pre">force_new_range:</span> <span class="pre">true</span></code> enforces the start of a new range at that address.</p></li>
<li><p><strong>offset</strong> (<em>Optional</em>, int): only required for uncommon response encodings offset from start address in bytes. If more than one register is read a modbus read registers command this value is used to find the start of this datapoint relative to start address. The component calculates the size of the range based on offset and size of the value type</p></li>
<li><p><strong>min_value</strong> (<em>Optional</em>, float): The minimum value this number can be.</p></li>
<li><p><strong>max_value</strong> (<em>Optional</em>, float): The maximum value this number can be.</p></li>
<li><p><strong>step</strong> (<em>Optional</em>, float): The granularity with which the number can be set. Defaults to 1</p></li>
<li><p><strong>custom_command</strong> (<em>Optional</em>, list of bytes): raw bytes for modbus command. This allows using non-standard commands. If <code class="docutils literal notranslate"><span class="pre">custom_command</span></code> is used <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">register_type</span></code> canâ€™t be used.
custom data must contain all required bytes including the modbus device address. The crc is automatically calculated and appended to the command.
See <a class="reference internal" href="../sensor/modbus_controller.html#modbus-custom-command"><span class="std std-ref">Using custom_command</span></a> how to use <code class="docutils literal notranslate"><span class="pre">custom_command</span></code></p></li>
<li><p><strong>lambda</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/automations.html#config-lambda"><span class="std std-ref">lambda</span></a>):
Lambda to be evaluated every update interval to get the new value of the sensor.</p>
<p>Parameters passed into the lambda</p>
<ul class="simple">
<li><p><strong>x</strong> (float): The parsed float value of the modbus data</p></li>
<li><p><strong>data</strong> (std::vector&lt;uint8_t): vector containing the complete raw modbus response bytes for this sensor
<em>note:</em> because the response contains data for all registers in the same range you have to use <code class="docutils literal notranslate"><span class="pre">data[item-&gt;offset]</span></code> to get the first response byte for your sensor.</p></li>
<li><p><strong>item</strong> (const pointer to a SensorItem derived object):  The sensor object itself.</p></li>
</ul>
<p>Possible return values for the lambda:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;FLOATING_POINT_NUMBER&gt;;</span></code> the new value for the sensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">NAN;</span></code> if the state should be considered invalid to indicate an error (advanced).</p></li>
</ul>
</li>
<li><p><strong>write_lambda</strong> (<em>Optional</em>, <a class="reference internal" href="../../guides/automations.html#config-lambda"><span class="std std-ref">lambda</span></a>): Lambda called before send.
Lambda is evaluated before the modbus write command is created.</p>
<p>Parameters passed into the lambda</p>
<ul class="simple">
<li><p><strong>x</strong> (float): The float value to be sent to the modbus device</p></li>
<li><p><strong>payload</strong> (<code class="docutils literal notranslate"><span class="pre">std::vector&lt;uint16_t&gt;&amp;payload</span></code>): empty vector for the payload. The lambda can add 16 bit raw modbus register words.
<em>note:</em> because the response contains data for all registers in the same range you have to use <code class="docutils literal notranslate"><span class="pre">data[item-&gt;offset]</span></code> to get the first response byte for your sensor.</p></li>
<li><p><strong>item</strong> (const pointer to a SensorItem derived object):  The sensor object itself.</p></li>
</ul>
<p>Possible return values for the lambda:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;FLOATING_POINT_NUMBER&gt;;</span></code> the new value for the sensor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">&lt;anything&gt;;</span> <span class="pre">and</span> <span class="pre">fill</span> <span class="pre">payload</span> <span class="pre">with</span> <span class="pre">data</span></code> if the payload is added from the lambda then these 16 bit words will be sent</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">{};</span></code> if you donâ€™t want write the command to the device (or do it from the lambda).</p></li>
</ul>
</li>
<li><p><strong>multiply</strong> (<em>Optional</em>, float): multiply the new value with this factor before sending the requests. Ignored if lambda is defined.</p></li>
<li><p><strong>use_write_multiple</strong> (<em>Optional</em>, boolean): By default the modbus command <code class="docutils literal notranslate"><span class="pre">Preset</span> <span class="pre">Single</span> <span class="pre">Registers</span></code> (function code 6) is used for setting the holding register if only 1 register is set. If your device only supports <code class="docutils literal notranslate"><span class="pre">Preset</span> <span class="pre">Multiple</span> <span class="pre">Registers</span></code> (function code 16) set this option to true.</p></li>
</ul>
<p>All other options from <a class="reference internal" href="index.html#config-number"><span class="std std-ref">Number</span></a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">number</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">platform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modbus_controller</span>
<span class="w">    </span><span class="nt">modbus_controller_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">epever</span>
<span class="w">    </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">battery_capacity_number</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Battery</span><span class="nv"> </span><span class="s">Cap</span><span class="nv"> </span><span class="s">Number&quot;</span>
<span class="w">    </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x9001</span>
<span class="w">    </span><span class="nt">value_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">U_WORD</span>
<span class="w">    </span><span class="nt">lambda</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return</span><span class="nv">  </span><span class="s">x</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">1.0;</span><span class="nv"> </span><span class="s">&quot;</span>
<span class="w">    </span><span class="nt">write_lambda</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">      </span><span class="no">ESP_LOGD(&quot;main&quot;,&quot;Modbus Number incoming value = %f&quot;,x);</span>
<span class="w">      </span><span class="no">uint16_t b_capacity = x ;</span>
<span class="w">      </span><span class="no">payload.push_back(b_capacity);</span>
<span class="w">      </span><span class="no">return x * 1.0 ;</span>
<span class="w">    </span><span class="c1">## multiply is ignored because lamdba is used</span>
<span class="w">    </span><span class="nt">multiply</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</pre></div>
</div>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this heading">Â¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../modbus_controller.html"><span class="doc">Modbus Controller</span></a></p></li>
<li><p><a class="reference internal" href="../sensor/modbus_controller.html"><span class="doc">Modbus Controller Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../binary_sensor/modbus_controller.html"><span class="doc">Modbus Controller Binary Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../switch/modbus_controller.html"><span class="doc">Modbus Controller Switch</span></a></p></li>
<li><p><a class="reference internal" href="../text_sensor/modbus_controller.html"><span class="doc">Modbus Controller Text Sensor</span></a></p></li>
<li><p><a class="reference internal" href="../output/modbus_controller.html"><span class="doc">Modbus Controller Output</span></a></p></li>
<li><p><a class="reference external" href="https://www.modbustools.com/modbus.html">https://www.modbustools.com/modbus.html</a></p></li>
<li><p><a class="reference external" href="https://github.com/esphome/esphome-docs/blob/current/components/number/modbus_controller.rst">Edit this page on GitHub</a></p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
  <div id="upgrade-footer">
    A new version has been release since you last visited this page: 2023.8.3 ðŸŽ‰
    <div class="footer-button-container">
      <div role="button" id="upgrade-footer-dismiss" class="footer-button">Dismiss</div>
      <a id="upgrade-footer-changelog" class="footer-button" href="/changelog/2023.8.0.html">View Changelog</a>
    </div>
  </div>
  <script>
    var old = window.localStorage.getItem("version");
    if (old === null || window.location.pathname.lastIndexOf("/changelog/", 0) === 0) { window.localStorage.setItem("version", "2023.8");
    } else if (old !== "2023.8") {
      const footerEl = document.getElementById("upgrade-footer");
      footerEl.classList.add("not-hidden");
      footerEl.addEventListener('click', function () {
        window.localStorage.setItem("version", "2023.8");
        footerEl.classList.remove("not-hidden");
      });
    }
  </script>

  </body>
</html>